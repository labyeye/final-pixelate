(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,32216,e=>{"use strict";var t=e.i(34371),a=e.i(10913),l=e.i(2507);let r=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("div",{className:"relative w-full overflow-auto",children:(0,t.jsx)("table",{ref:r,className:(0,l.cn)("w-full caption-bottom text-sm",e),...a})}));r.displayName="Table";let s=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("thead",{ref:r,className:(0,l.cn)("[&_tr]:border-b",e),...a}));s.displayName="TableHeader";let o=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("tbody",{ref:r,className:(0,l.cn)("[&_tr:last-child]:border-0",e),...a}));o.displayName="TableBody",a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("tfoot",{ref:r,className:(0,l.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...a})).displayName="TableFooter";let n=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("tr",{ref:r,className:(0,l.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...a}));n.displayName="TableRow";let i=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("th",{ref:r,className:(0,l.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...a}));i.displayName="TableHead";let d=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("td",{ref:r,className:(0,l.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...a}));d.displayName="TableCell",a.forwardRef(({className:e,...a},r)=>(0,t.jsx)("caption",{ref:r,className:(0,l.cn)("mt-4 text-sm text-muted-foreground",e),...a})).displayName="TableCaption",e.s(["Table",()=>r,"TableBody",()=>o,"TableCell",()=>d,"TableHead",()=>i,"TableHeader",()=>s,"TableRow",()=>n])},47153,e=>{"use strict";var t=e.i(34371),a=e.i(10913);let l=["not called","called","not interested","meeting booked","interested","call back later","other"];var r=e.i(63951),s=e.i(32216),o=e.i(84674);let n=(0,o.default)("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]),i=(0,o.default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);function d(){let[o,d]=(0,a.useState)([]),[c,h]=(0,a.useState)([]),[u,m]=(0,a.useState)(""),[f,g]=(0,a.useState)(""),[p,x]=(0,a.useState)(!1),[b,y]=(0,a.useState)({current:0,total:0}),[w,j]=(0,a.useState)(null),[S,T]=(0,a.useState)(!1),[v,N]=(0,a.useState)({current:0,total:0});async function k(){try{let e=localStorage.getItem("auth_token")||"",t=await fetch("/api/leads",{headers:e?{Authorization:"Bearer "+e}:{}});if(!t.ok)return console.warn("fetchLeadsWithAuth: server returned",t.status),[];let a=await t.json();if(!Array.isArray(a))return[];return a}catch(e){return console.error("fetchLeadsWithAuth error",e),[]}}async function C(){if(!w)return alert("Choose an Excel file first");let t=await e.A(12165),a=await w.arrayBuffer(),l=t.read(a,{type:"array"}),r=l.Sheets[l.SheetNames[0]],s=t.utils.sheet_to_json(r,{defval:""}).map(e=>{let t=(e["Staff Assigned"]||e.Staff||e.staff||"").toString().trim(),a=null;if(t&&((a=c.find(e=>e.name&&String(e.name).toLowerCase()===t.toLowerCase()))||(a=c.find(e=>e.name&&String(e.name).toLowerCase().includes(t.toLowerCase()))),!a)){let e=null,l=1/0;for(let a of c){if(!a.name)continue;let r=function(e,t){if(e===t)return 0;let a=e.length,l=t.length;if(0===a)return l;if(0===l)return a;let r=Array.from({length:a+1},()=>Array(l+1).fill(0));for(let e=0;e<=a;e++)r[e][0]=e;for(let e=0;e<=l;e++)r[0][e]=e;for(let s=1;s<=a;s++)for(let a=1;a<=l;a++){let l=+(e[s-1]!==t[a-1]);r[s][a]=Math.min(r[s-1][a]+1,r[s][a-1]+1,r[s-1][a-1]+l)}return r[a][l]}(String(a.name).toLowerCase(),t.toLowerCase());r<l&&(l=r,e=a)}e&&l<4&&(a=e)}return{name:e.Name||e["Full Name"]||e.name||"",phone:e.Phone||e.Phone||e.phone||"",category:e.Category||e.Category||e.category||"",email:e.Email||e.email||"",assignedTo:a?a._id||a.id:null,assignedToName:a?a.name:t||null,status:"not called",project:e.Project||e.project||"",value:e.Value||e.value||0,createdAt:new Date().toISOString()}}),o="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"":"https://backend.pixelatenest.com",n=localStorage.getItem("auth_token")||"";async function i(e,t=2){let a={"Content-Type":"application/json"};n&&(a.Authorization="Bearer "+n);for(let l=0;l<=t;l++){try{let t=await fetch(o+"/api/leads",{method:"POST",headers:a,body:JSON.stringify(e)});if(t.ok)return{ok:!0,status:t.status};if(t.status>=400&&t.status<500&&429!==t.status){let e=await t.text().catch(()=>String(t.status));return{ok:!1,status:t.status,message:e}}}catch(e){}await new Promise(e=>setTimeout(e,500*(l+1)))}return{ok:!1,status:0,message:"network or server error"}}T(!0),N({current:0,total:s.length});try{let e=[];for(let t=0;t<s.length;t+=500){let a=s.slice(t,t+500),l=await i(a,2);l.ok?N(e=>({current:Math.min(s.length,e.current+a.length),total:s.length})):(e.push(...a),console.warn("Batch failed:",{index:t,status:l.status,message:l.message}))}if(e.length){let t=localStorage.getItem("leads_local")||"[]",a=JSON.parse(t),l=[...e,...a];localStorage.setItem("leads_local",JSON.stringify(l)),d(t=>[...e,...t]),N({current:s.length-e.length,total:s.length}),alert(`Imported ${s.length-e.length} items to server. ${e.length} items saved locally due to upload failures.`)}else{try{let e=await k();d(e||[])}catch(e){console.warn("Failed to refresh after import",e)}N({current:s.length,total:s.length}),alert("Imported and saved to DB")}}catch(e){console.error("Unexpected import error",e),alert("Import failed due to an unexpected error. Check console.")}finally{T(!1)}}async function A(e){if(!e)return alert("Choose a staff member first");if(!confirm("Delete ALL leads assigned to this staff member? This cannot be undone."))return;let t="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"https://backend.pixelatenest.com":"",a=localStorage.getItem("auth_token")||"";try{let l=(await k()).filter(t=>String(t.assignedTo)===String(e));if(!l.length)return alert("No leads assigned to this staff member");for(let e of(x(!0),y({current:0,total:l.length}),l))try{let l=await fetch(t+"/api/leads/"+String(e._id||e.id),{method:"DELETE",headers:a?{Authorization:"Bearer "+a}:{}});if(!l.ok)throw Error("Server returned "+l.status)}catch(t){console.error("Failed to delete lead",e,t)}finally{y(e=>({current:Math.min(e.total,e.current+1),total:e.total}))}try{let e=await k();d(e||[])}catch(e){}alert("Deletion of assigned leads completed (check server logs for failures)")}catch(e){console.error("deleteLeadsForStaff failed",e),alert("Failed to delete assigned leads: "+(e instanceof Error?e.message:String(e)))}finally{x(!1),y({current:0,total:0}),m("")}}async function _(e){if(!e)return;let t="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"https://backend.pixelatenest.com":"";try{let a=localStorage.getItem("auth_token")||"",l=null;try{a&&(l=JSON.parse(atob(a.split(".")[1])))}catch(e){l=null}if(l&&"admin"===l.role&&(await fetch(t+"/api/leads/"+String(e),{method:"DELETE",headers:a?{Authorization:"Bearer "+a}:{}})).ok){d(o.filter(t=>String(t._id||t.id)!==String(e))),alert("Deleted from DB");return}let r=prompt("You are not allowed to permanently delete leads. Enter a short note to mark this lead as not deletable:")||"";await fetch(t+"/api/leads/"+String(e),{method:"PATCH",headers:{"Content-Type":"application/json",...a?{Authorization:"Bearer "+a}:{}},body:JSON.stringify({doNotDelete:!0,reason:r})}),d(o.map(t=>String(t._id||t.id)===String(e)?{...t,doNotDelete:!0,reason:r}:t)),alert("Marked as not deletable")}catch(t){console.error("Delete failed",t),d(o.filter(t=>String(t._id||t.id)!==String(e))),alert("Deleted locally (server may be unreachable)")}}async function B(e,t){if(!e)return;let a=prompt("Optional: enter a reason for this status change")||"";d(l=>l.map(l=>String(l._id||l.id)===String(e)?{...l,status:t,statusReason:a}:l));let l="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"https://backend.pixelatenest.com":"",r=localStorage.getItem("auth_token")||"";try{if(!(await fetch(l+"/api/leads/"+String(e),{method:"PATCH",headers:{"Content-Type":"application/json",...r?{Authorization:"Bearer "+r}:{}},body:JSON.stringify({status:t,statusReason:a})})).ok){try{let e=await k();d(e||[])}catch(e){}alert("Failed to update status on server")}}catch(e){console.error("Status update failed",e);try{let e=localStorage.getItem("auth_token")||"",t=await (await fetch("/api/leads",{headers:e?{Authorization:"Bearer "+e}:{}})).json();d(t||[])}catch(e){}alert("Network error while updating status")}}return(0,a.useEffect)(()=>{let e=!0;return(async()=>{try{let t=await k();e&&d(t);let a=await fetch("/api/team-members"),l=await a.json();e&&h(l||[])}catch(e){console.error("Failed to load leads/team",e)}})(),()=>{e=!1}},[]),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("header",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"Leads (Table)"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Import Excel (Name, Phone, Email, Staff Assigned). Staff auto-matched by name."})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:e=>j(e.target.files?e.target.files[0]:null)}),(0,t.jsxs)(r.Button,{onClick:C,disabled:S,children:[(0,t.jsx)(i,{className:"mr-2"})," Import"]})]}),(S||v.total>0)&&(0,t.jsxs)("div",{className:"mt-3 w-full max-w-2xl",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,t.jsx)("div",{className:"text-sm font-medium",children:"Import progress"}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:[v.current," of ",v.total]})]}),(0,t.jsx)("div",{className:"w-full h-3 bg-muted rounded overflow-hidden",children:(0,t.jsx)("div",{role:"progressbar","aria-valuemin":0,"aria-valuemax":v.total||100,"aria-valuenow":v.current,className:"h-3 bg-primary transition-all duration-500",style:{width:v.total>0?`${Math.round(v.current/v.total*100)}%`:"0%"}})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("label",{className:"text-sm",children:"Filter by staff:"}),(0,t.jsxs)("select",{value:u,onChange:e=>m(e.target.value),className:"px-2 py-1 rounded-md bg-background border",children:[(0,t.jsx)("option",{value:"",children:"-- Select staff --"}),c.map(e=>(0,t.jsx)("option",{value:String(e._id||e.id),children:e.name},String(e._id||e.id)))]}),(0,t.jsx)("label",{className:"text-sm",children:"Filter by status:"}),(0,t.jsxs)("select",{value:f,onChange:e=>g(e.target.value),className:"px-2 py-1 rounded-md bg-background border",children:[(0,t.jsx)("option",{value:"",children:"-- Any status --"}),l.map(e=>(0,t.jsx)("option",{value:e,children:e},e))]}),(0,t.jsx)(r.Button,{variant:"destructive",onClick:()=>A(u),disabled:!u||p,children:"Delete leads for selected staff"}),p?(0,t.jsxs)("div",{className:"text-sm",children:["Deleting ",b.current,"/",b.total,"..."]}):null]}),(0,t.jsxs)(s.Table,{children:[(0,t.jsx)(s.TableHeader,{children:(0,t.jsxs)(s.TableRow,{children:[(0,t.jsx)(s.TableHead,{children:"Name"}),(0,t.jsx)(s.TableHead,{children:"Category"}),(0,t.jsx)(s.TableHead,{children:"Phone"}),(0,t.jsx)(s.TableHead,{children:"Email"}),(0,t.jsx)(s.TableHead,{children:"Assigned"}),(0,t.jsx)(s.TableHead,{children:"Status"}),(0,t.jsx)(s.TableHead,{children:"Status Reason"}),(0,t.jsx)(s.TableHead,{children:"Actions"})]})}),(0,t.jsx)(s.TableBody,{children:o.filter(e=>(!u||String(e.assignedTo||e.assignedToName)===String(u))&&(!f||String(e.status||"")===String(f))).map(e=>(0,t.jsxs)(s.TableRow,{children:[(0,t.jsx)(s.TableCell,{children:e.name}),(0,t.jsx)(s.TableCell,{children:e.category||"-"}),(0,t.jsx)(s.TableCell,{children:e.phone}),(0,t.jsx)(s.TableCell,{children:e.email}),(0,t.jsx)(s.TableCell,{children:e.assignedToName||e.assignedTo||"-"}),(0,t.jsx)(s.TableCell,{children:(0,t.jsx)("select",{value:e.status||l[0],onChange:t=>B(e._id||e.id,t.target.value),className:"px-2 py-1 rounded-md bg-background border",children:l.map(e=>(0,t.jsx)("option",{value:e,children:e},e))})}),(0,t.jsx)(s.TableCell,{children:e.statusReason||"-"}),(0,t.jsxs)(s.TableCell,{children:[e.doNotDelete?(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Not deletable"}):null,(0,t.jsx)(r.Button,{variant:"destructive",size:"sm",onClick:()=>_(e._id||e.id),children:(0,t.jsx)(n,{})})]})]},String(e._id||e.id)))})]})]})}e.s(["default",()=>d],47153)},12165,e=>{e.v(t=>Promise.all(["static/chunks/721d4deb670ff411.js","static/chunks/8502d8d15b0776bf.js"].map(t=>e.l(t))).then(()=>t(63972)))}]);