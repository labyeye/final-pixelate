module.exports=[68932,a=>{"use strict";var b=a.i(57457),c=a.i(90782),d=a.i(59104);let e=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{className:"relative w-full overflow-auto",children:(0,b.jsx)("table",{ref:e,className:(0,d.cn)("w-full caption-bottom text-sm",a),...c})}));e.displayName="Table";let f=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("thead",{ref:e,className:(0,d.cn)("[&_tr]:border-b",a),...c}));f.displayName="TableHeader";let g=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("tbody",{ref:e,className:(0,d.cn)("[&_tr:last-child]:border-0",a),...c}));g.displayName="TableBody",c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("tfoot",{ref:e,className:(0,d.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...c})).displayName="TableFooter";let h=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("tr",{ref:e,className:(0,d.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...c}));h.displayName="TableRow";let i=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("th",{ref:e,className:(0,d.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...c}));i.displayName="TableHead";let j=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("td",{ref:e,className:(0,d.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...c}));j.displayName="TableCell",c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("caption",{ref:e,className:(0,d.cn)("mt-4 text-sm text-muted-foreground",a),...c})).displayName="TableCaption",a.s(["Table",()=>e,"TableBody",()=>g,"TableCell",()=>j,"TableHead",()=>i,"TableHeader",()=>f,"TableRow",()=>h])},22822,a=>{"use strict";var b=a.i(57457),c=a.i(90782);let d=["not called","called","not interested","meeting booked","interested","call back later","other"];var e=a.i(73647),f=a.i(68932),g=a.i(49854);let h=(0,g.default)("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]),i=(0,g.default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);function j(){let[g,j]=(0,c.useState)([]),[k,l]=(0,c.useState)([]),[m,n]=(0,c.useState)(""),[o,p]=(0,c.useState)(""),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)({current:0,total:0}),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)({current:0,total:0});async function A(){try{let a=localStorage.getItem("auth_token")||"",b=await fetch("/api/leads",{headers:a?{Authorization:"Bearer "+a}:{}});if(!b.ok)return console.warn("fetchLeadsWithAuth: server returned",b.status),[];let c=await b.json();if(!Array.isArray(c))return[];return c}catch(a){return console.error("fetchLeadsWithAuth error",a),[]}}async function B(){if(!u)return alert("Choose an Excel file first");let b=await a.A(52985),c=await u.arrayBuffer(),d=b.read(c,{type:"array"}),e=d.Sheets[d.SheetNames[0]],f=b.utils.sheet_to_json(e,{defval:""}).map(a=>{let b=(a["Staff Assigned"]||a.Staff||a.staff||"").toString().trim(),c=null;if(b&&((c=k.find(a=>a.name&&String(a.name).toLowerCase()===b.toLowerCase()))||(c=k.find(a=>a.name&&String(a.name).toLowerCase().includes(b.toLowerCase()))),!c)){let a=null,d=1/0;for(let c of k){if(!c.name)continue;let e=function(a,b){if(a===b)return 0;let c=a.length,d=b.length;if(0===c)return d;if(0===d)return c;let e=Array.from({length:c+1},()=>Array(d+1).fill(0));for(let a=0;a<=c;a++)e[a][0]=a;for(let a=0;a<=d;a++)e[0][a]=a;for(let f=1;f<=c;f++)for(let c=1;c<=d;c++){let d=+(a[f-1]!==b[c-1]);e[f][c]=Math.min(e[f-1][c]+1,e[f][c-1]+1,e[f-1][c-1]+d)}return e[c][d]}(String(c.name).toLowerCase(),b.toLowerCase());e<d&&(d=e,a=c)}a&&d<4&&(c=a)}return{name:a.Name||a["Full Name"]||a.name||"",phone:a.Phone||a.Phone||a.phone||"",category:a.Category||a.Category||a.category||"",email:a.Email||a.email||"",assignedTo:c?c._id||c.id:null,assignedToName:c?c.name:b||null,status:"not called",project:a.Project||a.project||"",value:a.Value||a.value||0,createdAt:new Date().toISOString()}}),g="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"":"https://backend.pixelatenest.com",h=localStorage.getItem("auth_token")||"";async function i(a,b=2){let c={"Content-Type":"application/json"};h&&(c.Authorization="Bearer "+h);for(let d=0;d<=b;d++){try{let b=await fetch(g+"/api/leads",{method:"POST",headers:c,body:JSON.stringify(a)});if(b.ok)return{ok:!0,status:b.status};if(b.status>=400&&b.status<500&&429!==b.status){let a=await b.text().catch(()=>String(b.status));return{ok:!1,status:b.status,message:a}}}catch(a){}await new Promise(a=>setTimeout(a,500*(d+1)))}return{ok:!1,status:0,message:"network or server error"}}x(!0),z({current:0,total:f.length});try{let a=[];for(let b=0;b<f.length;b+=500){let c=f.slice(b,b+500),d=await i(c,2);d.ok?z(a=>({current:Math.min(f.length,a.current+c.length),total:f.length})):(a.push(...c),console.warn("Batch failed:",{index:b,status:d.status,message:d.message}))}if(a.length){let b=localStorage.getItem("leads_local")||"[]",c=JSON.parse(b),d=[...a,...c];localStorage.setItem("leads_local",JSON.stringify(d)),j(b=>[...a,...b]),z({current:f.length-a.length,total:f.length}),alert(`Imported ${f.length-a.length} items to server. ${a.length} items saved locally due to upload failures.`)}else{try{let a=await A();j(a||[])}catch(a){console.warn("Failed to refresh after import",a)}z({current:f.length,total:f.length}),alert("Imported and saved to DB")}}catch(a){console.error("Unexpected import error",a),alert("Import failed due to an unexpected error. Check console.")}finally{x(!1)}}async function C(a){if(!a)return alert("Choose a staff member first");if(!confirm("Delete ALL leads assigned to this staff member? This cannot be undone."))return;let b="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"https://backend.pixelatenest.com":"",c=localStorage.getItem("auth_token")||"";try{let d=(await A()).filter(b=>String(b.assignedTo)===String(a));if(!d.length)return alert("No leads assigned to this staff member");for(let a of(r(!0),t({current:0,total:d.length}),d))try{let d=await fetch(b+"/api/leads/"+String(a._id||a.id),{method:"DELETE",headers:c?{Authorization:"Bearer "+c}:{}});if(!d.ok)throw Error("Server returned "+d.status)}catch(b){console.error("Failed to delete lead",a,b)}finally{t(a=>({current:Math.min(a.total,a.current+1),total:a.total}))}try{let a=await A();j(a||[])}catch(a){}alert("Deletion of assigned leads completed (check server logs for failures)")}catch(a){console.error("deleteLeadsForStaff failed",a),alert("Failed to delete assigned leads: "+(a instanceof Error?a.message:String(a)))}finally{r(!1),t({current:0,total:0}),n("")}}async function D(a){if(!a)return;let b="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"https://backend.pixelatenest.com":"";try{let c=localStorage.getItem("auth_token")||"",d=null;try{c&&(d=JSON.parse(atob(c.split(".")[1])))}catch(a){d=null}if(d&&"admin"===d.role&&(await fetch(b+"/api/leads/"+String(a),{method:"DELETE",headers:c?{Authorization:"Bearer "+c}:{}})).ok){j(g.filter(b=>String(b._id||b.id)!==String(a))),alert("Deleted from DB");return}let e=prompt("You are not allowed to permanently delete leads. Enter a short note to mark this lead as not deletable:")||"";await fetch(b+"/api/leads/"+String(a),{method:"PATCH",headers:{"Content-Type":"application/json",...c?{Authorization:"Bearer "+c}:{}},body:JSON.stringify({doNotDelete:!0,reason:e})}),j(g.map(b=>String(b._id||b.id)===String(a)?{...b,doNotDelete:!0,reason:e}:b)),alert("Marked as not deletable")}catch(b){console.error("Delete failed",b),j(g.filter(b=>String(b._id||b.id)!==String(a))),alert("Deleted locally (server may be unreachable)")}}async function E(a,b){if(!a)return;let c=prompt("Optional: enter a reason for this status change")||"";j(d=>d.map(d=>String(d._id||d.id)===String(a)?{...d,status:b,statusReason:c}:d));let d="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"https://backend.pixelatenest.com":"",e=localStorage.getItem("auth_token")||"";try{if(!(await fetch(d+"/api/leads/"+String(a),{method:"PATCH",headers:{"Content-Type":"application/json",...e?{Authorization:"Bearer "+e}:{}},body:JSON.stringify({status:b,statusReason:c})})).ok){try{let a=await A();j(a||[])}catch(a){}alert("Failed to update status on server")}}catch(a){console.error("Status update failed",a);try{let a=localStorage.getItem("auth_token")||"",b=await (await fetch("/api/leads",{headers:a?{Authorization:"Bearer "+a}:{}})).json();j(b||[])}catch(a){}alert("Network error while updating status")}}return(0,c.useEffect)(()=>{let a=!0;return(async()=>{try{let b=await A();a&&j(b);let c=await fetch("/api/team-members"),d=await c.json();a&&l(d||[])}catch(a){console.error("Failed to load leads/team",a)}})(),()=>{a=!1}},[]),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("header",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold",children:"Leads (Table)"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Import Excel (Name, Phone, Email, Staff Assigned). Staff auto-matched by name."})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:a=>v(a.target.files?a.target.files[0]:null)}),(0,b.jsxs)(e.Button,{onClick:B,disabled:w,children:[(0,b.jsx)(i,{className:"mr-2"})," Import"]})]}),(w||y.total>0)&&(0,b.jsxs)("div",{className:"mt-3 w-full max-w-2xl",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,b.jsx)("div",{className:"text-sm font-medium",children:"Import progress"}),(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:[y.current," of ",y.total]})]}),(0,b.jsx)("div",{className:"w-full h-3 bg-muted rounded overflow-hidden",children:(0,b.jsx)("div",{role:"progressbar","aria-valuemin":0,"aria-valuemax":y.total||100,"aria-valuenow":y.current,className:"h-3 bg-primary transition-all duration-500",style:{width:y.total>0?`${Math.round(y.current/y.total*100)}%`:"0%"}})})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("label",{className:"text-sm",children:"Filter by staff:"}),(0,b.jsxs)("select",{value:m,onChange:a=>n(a.target.value),className:"px-2 py-1 rounded-md bg-background border",children:[(0,b.jsx)("option",{value:"",children:"-- Select staff --"}),k.map(a=>(0,b.jsx)("option",{value:String(a._id||a.id),children:a.name},String(a._id||a.id)))]}),(0,b.jsx)("label",{className:"text-sm",children:"Filter by status:"}),(0,b.jsxs)("select",{value:o,onChange:a=>p(a.target.value),className:"px-2 py-1 rounded-md bg-background border",children:[(0,b.jsx)("option",{value:"",children:"-- Any status --"}),d.map(a=>(0,b.jsx)("option",{value:a,children:a},a))]}),(0,b.jsx)(e.Button,{variant:"destructive",onClick:()=>C(m),disabled:!m||q,children:"Delete leads for selected staff"}),q?(0,b.jsxs)("div",{className:"text-sm",children:["Deleting ",s.current,"/",s.total,"..."]}):null]}),(0,b.jsxs)(f.Table,{children:[(0,b.jsx)(f.TableHeader,{children:(0,b.jsxs)(f.TableRow,{children:[(0,b.jsx)(f.TableHead,{children:"Name"}),(0,b.jsx)(f.TableHead,{children:"Category"}),(0,b.jsx)(f.TableHead,{children:"Phone"}),(0,b.jsx)(f.TableHead,{children:"Email"}),(0,b.jsx)(f.TableHead,{children:"Assigned"}),(0,b.jsx)(f.TableHead,{children:"Status"}),(0,b.jsx)(f.TableHead,{children:"Status Reason"}),(0,b.jsx)(f.TableHead,{children:"Actions"})]})}),(0,b.jsx)(f.TableBody,{children:g.filter(a=>(!m||String(a.assignedTo||a.assignedToName)===String(m))&&(!o||String(a.status||"")===String(o))).map(a=>(0,b.jsxs)(f.TableRow,{children:[(0,b.jsx)(f.TableCell,{children:a.name}),(0,b.jsx)(f.TableCell,{children:a.category||"-"}),(0,b.jsx)(f.TableCell,{children:a.phone}),(0,b.jsx)(f.TableCell,{children:a.email}),(0,b.jsx)(f.TableCell,{children:a.assignedToName||a.assignedTo||"-"}),(0,b.jsx)(f.TableCell,{children:(0,b.jsx)("select",{value:a.status||d[0],onChange:b=>E(a._id||a.id,b.target.value),className:"px-2 py-1 rounded-md bg-background border",children:d.map(a=>(0,b.jsx)("option",{value:a,children:a},a))})}),(0,b.jsx)(f.TableCell,{children:a.statusReason||"-"}),(0,b.jsxs)(f.TableCell,{children:[a.doNotDelete?(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Not deletable"}):null,(0,b.jsx)(e.Button,{variant:"destructive",size:"sm",onClick:()=>D(a._id||a.id),children:(0,b.jsx)(h,{})})]})]},String(a._id||a.id)))})]})]})}a.s(["default",()=>j],22822)},52985,a=>{a.v(b=>Promise.all(["server/chunks/ssr/c729b_xlsx_xlsx_mjs_5ffb80a2._.js"].map(b=>a.l(b))).then(()=>b(51781)))}];

//# sourceMappingURL=Desktop_Projects_final-pixelate_dashboard_c673dc1f._.js.map