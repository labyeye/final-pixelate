module.exports=[52184,a=>{"use strict";var b=a.i(57457),c=a.i(90782),d=a.i(757);a.i(36553);var e=a.i(73647),f=a.i(59104),g=a.i(57952),h=a.i(24554),i=a.i(90423);a.i(48531);var j=a.i(58407);a.i(70575);var k=a.i(90537),l=a.i(68932),m=a.i(1856),n=a.i(1215);function o(){let a=(0,d.useRouter)(),[o,p]=(0,c.useState)([]),[q,r]=(0,c.useState)({}),{toast:s}=(0,i.useToast)(),{user:t}=(0,k.useAuth)();(0,c.useEffect)(()=>{let a=!0;return(async()=>{try{let b=await fetch("/api/quotations");if(!b.ok)throw Error(`Failed to fetch quotations: ${b.status}`);let c=await b.json();a&&p(c)}catch(a){console.error("Failed to load quotations",a)}})(),(async()=>{try{let b=await fetch("/api/clients");if(!b.ok)return;let c=await b.json(),d={};for(let a of c||[])a._id&&(d[String(a._id)]=a),a.id&&(d[String(a.id)]=a);a&&r(d)}catch(a){}})(),()=>{a=!1}},[]);let u=async(a,b)=>{let c=localStorage.getItem("auth_token")||"";try{let d=a.id||a._id;if(!d)throw Error("No id to update");let e=await fetch(`/api/quotations/${d}`,{method:"PUT",headers:{"Content-Type":"application/json",...c?{Authorization:`Bearer ${c}`}:{}},body:JSON.stringify({...a,status:b})});if(!e.ok)throw Error("Failed to update status");let f=await e.json();p(a=>a.map(a=>a.id&&f.id&&a.id===f.id||a._id&&f._id&&String(a._id)===String(f._id)?f:a)),s({title:"Updated",description:"Quotation status saved."})}catch(a){console.error("Failed to persist status",a),s({title:"Failed",description:a?.message||"Could not update status"})}},v=async a=>{let b=localStorage.getItem("auth_token")||"";try{let c=await fetch("/api/quotations/"+a,{method:"DELETE",headers:b?{Authorization:"Bearer "+b}:{}});if(!c.ok){let a=await c.json().catch(()=>({}));throw Error(a?.error||"Failed to delete")}p(b=>b.filter(b=>b.id!==a)),s({title:"Deleted",description:"Quotation deleted."})}catch(a){console.error("Failed to delete quotation",a),s({title:"Failed",description:a.message||"Could not delete"})}};return(0,b.jsxs)("div",{className:"space-y-8 font-headline",children:[(0,b.jsxs)("header",{className:"flex items-center justify-between gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-5xl font-black tracking-tighter",children:"QUOTATIONS"}),(0,b.jsx)("p",{className:"text-muted-foreground text-lg",children:"Create, send, and track client quotations."})]}),(0,b.jsx)("div",{className:"flex gap-2",children:(0,b.jsx)(e.Button,{size:"lg",className:"text-lg bg-[#F36F21] hover:bg-[#d85e1a]",onClick:()=>a.push("/quotations/create"),children:"New Professional Quotation"})})]}),(0,b.jsx)("div",{className:"border-2 border-black rounded-lg overflow-hidden",children:(0,b.jsxs)(l.Table,{children:[(0,b.jsx)(l.TableHeader,{children:(0,b.jsxs)(l.TableRow,{className:"border-b-2 border-black bg-gray-50",children:[(0,b.jsx)(l.TableHead,{className:"text-base font-bold",children:"Quote ID / Title"}),(0,b.jsx)(l.TableHead,{className:"text-base font-bold",children:"Client"}),(0,b.jsx)(l.TableHead,{className:"text-base font-bold",children:"Date"}),(0,b.jsx)(l.TableHead,{className:"text-base font-bold",children:"Services"}),(0,b.jsx)(l.TableHead,{className:"text-base font-bold",children:"Modules"}),(0,b.jsx)(l.TableHead,{className:"text-base font-bold text-right",children:"Total Amount"}),(0,b.jsx)(l.TableHead,{className:"text-base font-bold text-center",children:"Status"}),(0,b.jsx)(l.TableHead,{className:"text-base font-bold text-right",children:"Actions"})]})}),(0,b.jsx)(l.TableBody,{children:0===o.length?(0,b.jsx)(l.TableRow,{children:(0,b.jsx)(l.TableCell,{colSpan:8,className:"text-center py-10 text-muted-foreground",children:"No quotations found. Create your first quotation to get started."})}):o.map((c,d)=>{let i=(c.services||[]).reduce((a,b)=>{let c=Number(b?.amount??NaN),d=Number(b?.total??NaN),e=b?.price&&b?.qty?Number(b.price)*Number(b.qty):NaN,f=b?.unitPrice&&b?.qty?Number(b.unitPrice)*Number(b.qty):NaN;return a+(Number.isFinite(c)&&!Number.isNaN(c)?c:Number.isFinite(d)&&!Number.isNaN(d)?d:Number.isFinite(e)&&!Number.isNaN(e)?e:Number.isFinite(f)&&!Number.isNaN(f)?f:0)},0)||c.amount||0;return(0,b.jsxs)(l.TableRow,{className:"border-b border-gray-200 last:border-b-0 hover:bg-orange-50 transition-colors",children:[(0,b.jsxs)(l.TableCell,{className:"py-4 max-w-xs",children:[(0,b.jsx)("div",{className:"font-bold text-base text-[#F36F21]",children:c.quoteId||c.id||`PN-${String(d+1).padStart(5,"0")}`}),(0,b.jsx)("div",{className:"text-sm font-semibold text-gray-900 mt-1 truncate",children:c.title||"Untitled Project"}),c.subtitle&&(0,b.jsx)("div",{className:"text-xs text-gray-600 mt-0.5 truncate",children:c.subtitle})]}),(0,b.jsxs)(l.TableCell,{className:"py-4",children:[(0,b.jsx)("div",{className:"font-bold text-gray-900",children:c.clientId&&q[String(c.clientId)]?.businessName||c.clientId&&q[String(c.clientId)]?.name||c.clientName||"Client"}),c.clientId&&q[String(c.clientId)]?.email&&(0,b.jsx)("div",{className:"text-xs text-gray-600 mt-0.5",children:q[String(c.clientId)].email})]}),(0,b.jsx)(l.TableCell,{className:"py-4",children:(0,b.jsx)("div",{className:"text-sm text-gray-900",children:c.date?new Date(c.date).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"N/A"})}),(0,b.jsx)(l.TableCell,{className:"py-4 max-w-xs",children:(0,b.jsxs)("div",{className:"flex flex-wrap gap-1",children:[c.services&&c.services.length>0?c.services.slice(0,3).map((a,c)=>(0,b.jsx)(m.Badge,{variant:"secondary",className:"text-xs",children:a.serviceName||a.name||"Service"},`${String(a._id??a.id??a.serviceName??"service")}-${c}`)):(0,b.jsx)("span",{className:"text-xs text-gray-500",children:"No services"}),c.services&&c.services.length>3&&(0,b.jsxs)(m.Badge,{variant:"outline",className:"text-xs",children:["+",c.services.length-3," more"]})]})}),(0,b.jsx)(l.TableCell,{className:"py-4 max-w-xs",children:(0,b.jsxs)("div",{className:"flex flex-wrap gap-1",children:[c.modules&&c.modules.length>0?c.modules.slice(0,2).map((a,c)=>(0,b.jsx)(m.Badge,{variant:"outline",className:"text-xs",children:a.moduleName||"Module"},`${String(a._id??a.id??a.moduleName??"module")}-${c}`)):(0,b.jsx)("span",{className:"text-xs text-gray-500",children:"No modules"}),c.modules&&c.modules.length>2&&(0,b.jsxs)(m.Badge,{variant:"outline",className:"text-xs",children:["+",c.modules.length-2]})]})}),(0,b.jsx)(l.TableCell,{className:"text-right font-bold text-base py-4",children:(0,j.formatCurrency)(i)}),(0,b.jsx)(l.TableCell,{className:"text-center py-4",children:(0,b.jsxs)(n.Select,{value:c.status||"PENDING",onValueChange:a=>{p(b=>b.map(b=>(b._id&&c._id?String(b._id)===String(c._id):b.id&&c.id&&b.id===c.id)?{...b,status:a}:b)),u(c,a)},children:[(0,b.jsx)(n.SelectTrigger,{className:(0,f.cn)("h-9 px-3 font-semibold text-xs w-[110px]","APPROVED"===c.status&&"bg-green-100 text-green-800 border-green-300","REJECTED"===c.status&&"bg-red-100 text-red-800 border-red-300",(!c.status||"PENDING"===c.status)&&"bg-yellow-100 text-yellow-800 border-yellow-300"),children:(0,b.jsx)(n.SelectValue,{})}),(0,b.jsxs)(n.SelectContent,{children:[(0,b.jsx)(n.SelectItem,{value:"PENDING",children:"PENDING"}),(0,b.jsx)(n.SelectItem,{value:"APPROVED",children:"APPROVED"}),(0,b.jsx)(n.SelectItem,{value:"REJECTED",children:"REJECTED"})]})]})}),(0,b.jsx)(l.TableCell,{className:"text-right py-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,b.jsx)(e.Button,{size:"sm",variant:"outline",className:"h-8",onClick:()=>a.push(`/quotations/${c._id||c.id}/view`),children:"View"}),"APPROVED"===c.status&&(0,b.jsx)(e.Button,{size:"sm",className:"bg-[#F36F21] hover:bg-[#d85e1a] h-8",onClick:()=>{let a,b;return a=c.services??[],b={id:new Date().getTime(),title:`New Project for ${c.clientName}`,client:c.clientName,progress:0,description:`Project created from quotation ${c.id}. Services: ${a.map(a=>a.name).join(", ")}`},void(window.__projectsStore.push(b),s({title:"Project Created!",description:`A new project has been created for ${c.clientName}.`}))},children:"Create Project"}),(0,b.jsxs)(g.DropdownMenu,{children:[(0,b.jsx)(g.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",children:(0,b.jsx)(h.MoreVertical,{className:"h-4 w-4"})})}),(0,b.jsx)(g.DropdownMenuContent,{align:"end",children:(0,b.jsx)(g.DropdownMenuItem,{onClick:()=>{let a=c._id||c.id;a&&confirm("Are you sure you want to delete this quotation?")&&v(String(a))},className:"text-destructive font-semibold",children:"Delete"})})]})]})})]},c._id??c.id??d)})})]})})]})}a.s(["default",()=>o],52184)}];

//# sourceMappingURL=3d860_Projects_final-pixelate_dashboard_src_app_%28crm%29_quotations_page_tsx_4b7c3d9d._.js.map