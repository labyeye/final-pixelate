module.exports=[12297,a=>{"use strict";var b=a.i(57457),c=a.i(90782),d=a.i(68932),e=a.i(24231),f=a.i(16458),g=a.i(88644),h=a.i(73647),i=a.i(1689),j=a.i(63420),k=a.i(42379),l=a.i(1215),m=a.i(59361);let n=g.z.object({name:g.z.string().min(2,{message:"Name is required."}),email:g.z.string().email({message:"A valid email is required."}),password:g.z.string().min(6,{message:"Password must be at least 6 characters."}).optional(),loginRole:g.z.union([g.z.literal("staff"),g.z.literal("admin")]).optional(),phone:g.z.string().min(10,{message:"A valid phone number is required."}),address:g.z.string().min(5,{message:"Address is required."}),role:g.z.union([g.z.literal("Founder"),g.z.literal("Co-Founder"),g.z.literal("Web Developer"),g.z.literal("Editor"),g.z.literal("Designer"),g.z.literal("Project Manager"),g.z.literal("Lead Generator")]),pan:g.z.string().optional(),aadhar:g.z.string().optional(),secondaryPhone:g.z.string().optional(),secondaryEmail:g.z.string().email().optional().or(g.z.literal("")),salary:g.z.coerce.number().optional()});function o({isOpen:a,setIsOpen:d,onAddMember:g,onSave:o,initialValues:p,onCreated:q,children:r}){let s=(0,e.useForm)({resolver:(0,f.zodResolver)(n),defaultValues:{name:p?.name??"",email:p?.email??"",password:"",loginRole:"staff",phone:p?.phone??"",address:p?.address??"",role:p?.role??"Web Developer"}});async function t(a){console.debug("AddMemberDialog onSubmit values:",a);let b={name:a.name,email:a.email,password:a.password,loginRole:a.loginRole,phone:a.phone,address:a.address,role:a.role,pan:a.pan,aadhar:a.aadhar,secondaryPhone:a.secondaryPhone,secondaryEmail:a.secondaryEmail,salary:a.salary};if(p&&(p._id||p.id)){let a=p._id??p.id;if(o)try{let c={...b};c.role&&(c.jobRole=c.role,delete c.role),c.loginRole&&(c.role=c.loginRole,delete c.loginRole),await o(a,c)}catch(a){console.error("onSave failed",a),alert("Failed to save team member: "+(a?.message||String(a)));return}}else{let c=null,d=!1;if(g)try{let a=await g(b);d=!0,c=a??null}catch(a){console.error("onAddMember failed",a),d=!1}if(!d)try{let d={...b,jobRole:b.role,role:a.loginRole??"staff"};a.password&&(d.password=a.password),delete d.role,console.debug("Posting consolidated userBody to /api/users",d);let e=await fetch("/api/users",{method:"POST",body:JSON.stringify(d),headers:{"Content-Type":"application/json"}});if(!e.ok){let a=await e.text();throw Error(`Failed to create user/team member: ${e.status} ${a}`)}c=await e.json(),q&&q(c)}catch(a){console.error("Failed to create team member via API",a),alert("Failed to create team member: "+(a?.message||String(a)));return}}s.reset(),d(!1)}return c.default.useEffect(()=>{p&&s.reset({name:p.name??"",email:p.email??"",password:p.password??"",loginRole:p.loginRole??"staff",phone:p.phone??"",address:p.address??"",role:p.role??"Web Developer",pan:p.pan??void 0,aadhar:p.aadhar??void 0,secondaryPhone:p.secondaryPhone??void 0,secondaryEmail:p.secondaryEmail??void 0,salary:p.salary??void 0})},[p]),(0,b.jsxs)(i.Dialog,{open:a,onOpenChange:d,children:[(0,b.jsx)(i.DialogTrigger,{asChild:!0,children:r}),(0,b.jsxs)(i.DialogContent,{className:"max-w-2xl",children:[(0,b.jsxs)(i.DialogHeader,{children:[(0,b.jsx)(i.DialogTitle,{className:"font-headline text-3xl font-black tracking-tighter",children:"Add New Team Member"}),(0,b.jsx)(i.DialogDescription,{children:"Fill in the details for the new developer, editor, or designer."})]}),(0,b.jsx)(k.Form,{...s,children:(0,b.jsxs)("form",{onSubmit:s.handleSubmit(t),className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsx)(k.FormField,{control:s.control,name:"name",render:({field:a})=>(0,b.jsxs)(k.FormItem,{children:[(0,b.jsx)(k.FormLabel,{children:"Full Name"}),(0,b.jsx)(k.FormControl,{children:(0,b.jsx)(j.Input,{...a})}),(0,b.jsx)(k.FormMessage,{})]})}),(0,b.jsx)(k.FormField,{control:s.control,name:"email",render:({field:a})=>(0,b.jsxs)(k.FormItem,{children:[(0,b.jsx)(k.FormLabel,{children:"Primary Email"}),(0,b.jsx)(k.FormControl,{children:(0,b.jsx)(j.Input,{type:"email",...a})}),(0,b.jsx)(k.FormMessage,{})]})}),(0,b.jsx)(k.FormField,{control:s.control,name:"password",render:({field:a})=>(0,b.jsxs)(k.FormItem,{children:[(0,b.jsx)(k.FormLabel,{children:"Sign-in Password (optional)"}),(0,b.jsx)(k.FormControl,{children:(0,b.jsx)(j.Input,{type:"password",placeholder:"Set a password to allow sign-in",...a})}),(0,b.jsx)(k.FormMessage,{})]})}),(0,b.jsx)(k.FormField,{control:s.control,name:"loginRole",render:({field:a})=>(0,b.jsxs)(k.FormItem,{children:[(0,b.jsx)(k.FormLabel,{children:"Auth Role"}),(0,b.jsxs)(l.Select,{value:a.value??"staff",onValueChange:a.onChange,children:[(0,b.jsx)(k.FormControl,{children:(0,b.jsx)(l.SelectTrigger,{children:(0,b.jsx)(l.SelectValue,{placeholder:"Select auth role"})})}),(0,b.jsxs)(l.SelectContent,{children:[(0,b.jsx)(l.SelectItem,{value:"staff",children:"Staff"}),(0,b.jsx)(l.SelectItem,{value:"admin",children:"Admin"})]})]}),(0,b.jsx)(k.FormMessage,{})]})}),(0,b.jsx)(k.FormField,{control:s.control,name:"phone",render:({field:a})=>(0,b.jsxs)(k.FormItem,{children:[(0,b.jsx)(k.FormLabel,{children:"Primary Phone"}),(0,b.jsx)(k.FormControl,{children:(0,b.jsx)(j.Input,{type:"tel",...a})}),(0,b.jsx)(k.FormMessage,{})]})}),(0,b.jsx)(k.FormField,{control:s.control,name:"role",render:({field:a})=>(0,b.jsxs)(k.FormItem,{children:[(0,b.jsx)(k.FormLabel,{children:"Role"}),(0,b.jsxs)(l.Select,{value:a.value??"Web Developer",onValueChange:a.onChange,children:[(0,b.jsx)(k.FormControl,{children:(0,b.jsx)(l.SelectTrigger,{children:(0,b.jsx)(l.SelectValue,{placeholder:"Select a role"})})}),(0,b.jsxs)(l.SelectContent,{children:[(0,b.jsx)(l.SelectItem,{value:"Founder",children:"Founder"}),(0,b.jsx)(l.SelectItem,{value:"Co-Founder",children:"Co-Founder"}),(0,b.jsx)(l.SelectItem,{value:"Web Developer",children:"Web Developer"}),(0,b.jsx)(l.SelectItem,{value:"Editor",children:"Editor"}),(0,b.jsx)(l.SelectItem,{value:"Designer",children:"Designer"}),(0,b.jsx)(l.SelectItem,{value:"Project Manager",children:"Project Manager"}),(0,b.jsx)(l.SelectItem,{value:"Lead Generator",children:"Lead Generator"})]})]}),(0,b.jsx)(k.FormMessage,{})]})}),(0,b.jsx)(k.FormField,{control:s.control,name:"address",render:({field:a})=>(0,b.jsxs)(k.FormItem,{className:"md:col-span-2",children:[(0,b.jsx)(k.FormLabel,{children:"Address"}),(0,b.jsx)(k.FormControl,{children:(0,b.jsx)(m.Textarea,{...a})}),(0,b.jsx)(k.FormMessage,{})]})}),(0,b.jsx)(k.FormField,{control:s.control,name:"salary",render:({field:a})=>(0,b.jsxs)(k.FormItem,{children:[(0,b.jsx)(k.FormLabel,{children:"Salary (Optional)"}),(0,b.jsx)(k.FormControl,{children:(0,b.jsx)(j.Input,{type:"number",placeholder:"e.g., 50000",...a})}),(0,b.jsx)(k.FormMessage,{})]})}),(0,b.jsx)(k.FormField,{control:s.control,name:"pan",render:({field:a})=>(0,b.jsxs)(k.FormItem,{children:[(0,b.jsx)(k.FormLabel,{children:"PAN (Optional)"}),(0,b.jsx)(k.FormControl,{children:(0,b.jsx)(j.Input,{placeholder:"ABCDE1234F",...a})}),(0,b.jsx)(k.FormMessage,{})]})}),(0,b.jsx)(k.FormField,{control:s.control,name:"aadhar",render:({field:a})=>(0,b.jsxs)(k.FormItem,{children:[(0,b.jsx)(k.FormLabel,{children:"Aadhar (Optional)"}),(0,b.jsx)(k.FormControl,{children:(0,b.jsx)(j.Input,{placeholder:"1234 5678 9012",...a})}),(0,b.jsx)(k.FormMessage,{})]})}),(0,b.jsx)(k.FormField,{control:s.control,name:"secondaryEmail",render:({field:a})=>(0,b.jsxs)(k.FormItem,{children:[(0,b.jsx)(k.FormLabel,{children:"Secondary Email (Optional)"}),(0,b.jsx)(k.FormControl,{children:(0,b.jsx)(j.Input,{type:"email",...a})}),(0,b.jsx)(k.FormMessage,{})]})}),(0,b.jsx)(k.FormField,{control:s.control,name:"secondaryPhone",render:({field:a})=>(0,b.jsxs)(k.FormItem,{children:[(0,b.jsx)(k.FormLabel,{children:"Secondary Phone (Optional)"}),(0,b.jsx)(k.FormControl,{children:(0,b.jsx)(j.Input,{type:"tel",...a})}),(0,b.jsx)(k.FormMessage,{})]})})]}),(0,b.jsx)(i.DialogFooter,{children:(0,b.jsx)(h.Button,{type:"submit",size:"lg",className:"text-lg w-full mt-4",children:"Create Team Member"})})]})})]})]})}var p=a.i(57952),q=a.i(39146),r=a.i(24554),s=a.i(90537),t=a.i(15404);function u(){let{user:a}=(0,s.useAuth)(),[e,f]=(0,c.useState)([]),[g,i]=(0,c.useState)(!1),[j,k]=(0,c.useState)(null),[l,m]=(0,c.useState)(!1),[n,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)(null),[x,y]=(0,c.useState)(!1);(0,c.useEffect)(()=>{let a=!0;return i(!0),k(null),(async()=>{try{let b=await fetch("/api/users");if(!b.ok){let a=await b.text();throw Error(`Failed to fetch users: ${b.status} ${a}`)}let c=await b.json();a&&f(c)}catch(b){console.error("Failed to load users",b),a&&k(b?.message||String(b))}finally{a&&i(!1)}})(),()=>{a=!1}},[]);let z=async()=>{try{i(!0),k(null);let a=await fetch("/api/users");if(!a.ok){let b=await a.text();throw Error(`users fetch failed: ${a.status} ${b}`)}let b=await a.json();f(b)}catch(a){console.error("Refresh failed",a),k(a?.message||String(a))}finally{i(!1)}};if(a?.role!=="admin")return(0,b.jsx)("div",{className:"space-y-8 font-headline",children:(0,b.jsxs)(t.Card,{className:"border-2 border-black",children:[(0,b.jsx)(t.CardHeader,{children:(0,b.jsx)(t.CardTitle,{className:"text-2xl font-black tracking-tighter",children:"Access Denied"})}),(0,b.jsx)(t.CardContent,{children:(0,b.jsx)("p",{className:"text-lg",children:"You do not have permission to view this page."})})]})});let A=async a=>{try{let b={...a,jobRole:a.role,role:a.loginRole??"staff"},c=await fetch("/api/users",{method:"POST",body:JSON.stringify(b),headers:{"Content-Type":"application/json"}});if(!c.ok)throw Error(`Failed to create member: ${c.status}`);let d=await c.json();return f(a=>[...a,d]),d}catch(a){throw console.error("Failed to add member",a),a}},B=async a=>{try{let b=a._id??a.id,c=await fetch(`/api/users/${b}`,{method:"DELETE"});if(!c.ok)throw Error(`Failed to delete user: ${c.status}`);f(a=>a.filter(a=>(a._id??a.id)!==b))}catch(a){console.error("Failed to delete user",a)}},C=async(a,b)=>{try{let c=await fetch(`/api/users/${a}`,{method:"PUT",body:JSON.stringify(b),headers:{"Content-Type":"application/json"}});if(!c.ok)throw Error(`Failed to update user: ${c.status}`);let d=await c.json();f(b=>b.map(b=>(b._id??b.id)===a?d:b)),y(!1)}catch(a){throw console.error("Failed to save user",a),a}};return(0,b.jsxs)("div",{className:"space-y-8 font-headline",children:[(0,b.jsxs)("header",{className:"flex items-center justify-between gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-5xl font-black tracking-tighter",children:"DEVELOPERS & EDITORS"}),(0,b.jsx)("p",{className:"text-muted-foreground text-lg",children:"Manage your creative and technical team members."})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(h.Button,{onClick:z,variant:"ghost",children:"Refresh"}),(0,b.jsx)(o,{isOpen:l,setIsOpen:m,onAddMember:A,onCreated:a=>f(b=>[...b,a]),children:(0,b.jsx)(h.Button,{size:"lg",className:"text-lg",children:"Add New"})})]}),(0,b.jsx)(o,{isOpen:x,setIsOpen:y,initialValues:v??void 0,onSave:async(a,b)=>{await C(a,b)},children:(0,b.jsx)("div",{})})]}),(0,b.jsxs)("div",{className:"border-2 border-black",children:[(0,b.jsx)("div",{className:"p-4 flex items-center justify-between",children:(0,b.jsxs)("div",{children:[g?(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Loadingâ€¦"}):null,j?(0,b.jsx)("div",{className:"text-sm text-destructive",children:j}):null]})}),(0,b.jsxs)(d.Table,{children:[(0,b.jsx)(d.TableHeader,{children:(0,b.jsxs)(d.TableRow,{className:"border-b-2 border-black",children:[(0,b.jsx)(d.TableHead,{className:"text-base font-bold",children:"Name"}),(0,b.jsx)(d.TableHead,{className:"text-base font-bold",children:"Email"}),(0,b.jsx)(d.TableHead,{className:"text-base font-bold",children:"Auth Role"}),(0,b.jsx)(d.TableHead,{className:"text-base font-bold",children:"Job Role"}),(0,b.jsx)(d.TableHead,{className:"text-base font-bold",children:"Phone"}),(0,b.jsx)(d.TableHead,{className:"text-base font-bold",children:"Address"}),(0,b.jsx)(d.TableHead,{className:"text-base font-bold",children:"Created"}),(0,b.jsx)(d.TableHead,{className:"text-right text-base font-bold",children:"Actions"})]})}),(0,b.jsx)(d.TableBody,{children:e.map(a=>(0,b.jsxs)(d.TableRow,{className:"border-b-2 border-black last:border-b-0",children:[(0,b.jsx)(d.TableCell,{className:"font-bold text-base py-4",children:a.name}),(0,b.jsx)(d.TableCell,{className:"text-base py-4",children:a.email}),(0,b.jsx)(d.TableCell,{className:"text-base py-4",children:a.role??"staff"}),(0,b.jsx)(d.TableCell,{className:"text-base py-4",children:a.jobRole??""}),(0,b.jsx)(d.TableCell,{className:"text-base py-4",children:a.phone}),(0,b.jsx)(d.TableCell,{className:"text-base py-4",children:a.address}),(0,b.jsx)(d.TableCell,{className:"text-base py-4",children:a.createdAt?new Date(a.createdAt).toLocaleString():""}),(0,b.jsx)(d.TableCell,{className:"text-right py-4 text-base font-bold uppercase",children:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,b.jsx)("div",{children:a.role??"staff"}),(0,b.jsxs)(p.DropdownMenu,{children:[(0,b.jsx)(p.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(h.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",children:(0,b.jsx)(r.MoreVertical,{className:"h-5 w-5"})})}),(0,b.jsxs)(p.DropdownMenuContent,{align:"end",children:[(0,b.jsx)(p.DropdownMenuItem,{onClick:()=>{w(a),y(!0)},children:"Edit"}),(0,b.jsx)(p.DropdownMenuItem,{onClick:()=>B(a),className:"text-destructive",children:"Delete"})]})]})]})})]},a._id??a.id))})]})]}),v&&(0,b.jsx)(q.default,{isOpen:x,setIsOpen:y,initialValues:v,onSave:async a=>{let b=v._id??v.id;await C(b,a)}})]})}a.s(["default",()=>u],12297)}];

//# sourceMappingURL=7e03e_final-pixelate_dashboard_src_app_%28crm%29_developers-and-editors_page_tsx_2981a6e6._.js.map