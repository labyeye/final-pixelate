module.exports=[74285,a=>{"use strict";var b=a.i(57457),c=a.i(90782),d=a.i(757),e=a.i(24231),f=a.i(16458),g=a.i(88644),h=a.i(73647),i=a.i(63420),j=a.i(59361),k=a.i(15404),l=a.i(16513),m=a.i(28316),n=a.i(22237),o=a.i(90423);let p=g.z.object({title:g.z.string().min(1,"Title is required"),subtitle:g.z.string().optional(),date:g.z.string(),clientId:g.z.string().min(1,"Client is required"),objective:g.z.string().min(1,"Objective is required"),purpose:g.z.string().min(1,"Purpose is required"),scope:g.z.array(g.z.object({value:g.z.string()})),deliverables:g.z.array(g.z.object({value:g.z.string()})),timeline:g.z.array(g.z.object({phase:g.z.string(),description:g.z.string(),duration:g.z.string()})),lineItems:g.z.array(g.z.object({name:g.z.string(),qty:g.z.number(),unitPrice:g.z.number(),tax:g.z.number(),total:g.z.number()})),services:g.z.array(g.z.object({serviceName:g.z.string(),qty:g.z.number(),price:g.z.number(),total:g.z.number()})),modules:g.z.array(g.z.object({moduleName:g.z.string(),description:g.z.string(),status:g.z.enum(["Planned","Ongoing","Completed"])})),notes:g.z.string().optional(),paymentTerms:g.z.string().optional()});function q(){let a=(0,d.useRouter)(),g=(0,d.useSearchParams)().get("edit"),{toast:q}=(0,o.useToast)(),[r,s]=(0,c.useState)([]),[t,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)(!1),{register:x,control:y,handleSubmit:z,watch:A,setValue:B,formState:{errors:C}}=(0,e.useForm)({resolver:(0,f.zodResolver)(p),defaultValues:{date:new Date().toISOString().split("T")[0],scope:[{value:""}],deliverables:[{value:""}],timeline:[{phase:"",description:"",duration:""}],lineItems:[{name:"",qty:1,unitPrice:0,tax:0,total:0}],services:[{serviceName:"",qty:1,price:0,total:0}],modules:[{moduleName:"",description:"",status:"Planned"}]}}),{fields:D,append:E,remove:F}=(0,e.useFieldArray)({control:y,name:"scope"}),{fields:G,append:H,remove:I}=(0,e.useFieldArray)({control:y,name:"deliverables"}),{fields:J,append:K,remove:L}=(0,e.useFieldArray)({control:y,name:"timeline"}),{fields:M,append:N,remove:O}=(0,e.useFieldArray)({control:y,name:"lineItems"}),{fields:P,append:Q,remove:R}=(0,e.useFieldArray)({control:y,name:"services"}),{fields:S,append:T,remove:U}=(0,e.useFieldArray)({control:y,name:"modules"});(0,c.useEffect)(()=>{(async()=>{let a=await fetch("/api/clients");a.ok&&s(await a.json())})()},[]),(0,c.useEffect)(()=>{g&&(async()=>{try{let a=await fetch(`/api/quotations/${g}`);if(!a.ok)throw Error("Failed to fetch quotation");let b=await a.json();w(!0),B("title",b.title||""),B("subtitle",b.subtitle||""),B("date",b.date?.split("T")[0]||new Date().toISOString().split("T")[0]),B("clientId",b.clientId||""),B("objective",b.objective||""),B("purpose",b.purpose||""),B("notes",b.notes||""),B("paymentTerms",b.paymentTerms||""),b.scope&&b.scope.length>0&&B("scope",b.scope.map(a=>({value:a}))),b.deliverables&&b.deliverables.length>0&&B("deliverables",b.deliverables.map(a=>({value:a}))),b.timeline&&b.timeline.length>0&&B("timeline",b.timeline),b.lineItems&&b.lineItems.length>0&&B("lineItems",b.lineItems),b.services&&b.services.length>0&&B("services",b.services),b.modules&&b.modules.length>0&&B("modules",b.modules)}catch(a){console.error("Error loading quotation:",a),q({title:"Error",description:"Failed to load quotation for editing",variant:"destructive"})}})()},[g,B,q]);let V=A("lineItems");(0,c.useEffect)(()=>{V.forEach((a,b)=>{let c=a.qty*a.unitPrice*(1+a.tax/100);c!==a.total&&B(`lineItems.${b}.total`,c)})},[V,B]);let W=A("services");(0,c.useEffect)(()=>{W.forEach((a,b)=>{let c=a.qty*a.price;c!==a.total&&B(`services.${b}.total`,c)})},[W,B]);let X=async b=>{u(!0);try{let c={...b,scope:b.scope.map(a=>a.value).filter(Boolean),deliverables:b.deliverables.map(a=>a.value).filter(Boolean),status:"DRAFT"};if(v&&g){let b=await fetch(`/api/quotations/${g}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!b.ok)throw Error("Failed to update quotation");let d=await b.json();q({title:"Success",description:"Quotation updated successfully"}),a.push(`/quotations/${d._id||d.id||g}/view`)}else{let b=await fetch("/api/quotations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!b.ok)throw Error("Failed to create quotation");let d=await b.json();q({title:"Success",description:"Quotation created successfully"}),a.push(`/quotations/${d._id||d.id}/view`)}}catch(a){console.error("Error saving quotation:",a),q({title:"Error",description:a.message||"Failed to create quotation",variant:"destructive"})}finally{u(!1)}};return(0,b.jsxs)("div",{className:"max-w-5xl mx-auto py-8 px-4 space-y-6 font-headline",children:[(0,b.jsxs)("header",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-4xl font-black tracking-tight",children:"Create Quotation"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1",children:"Build a professional proposal"})]}),(0,b.jsxs)(h.Button,{onClick:z(X),disabled:t,size:"lg",children:[(0,b.jsx)(n.Save,{className:"mr-2 h-4 w-4"}),t?"Saving...":"Save Quotation"]})]}),(0,b.jsxs)("form",{onSubmit:z(X),className:"space-y-6",children:[(0,b.jsxs)(k.Card,{className:"border-2 border-black",children:[(0,b.jsx)(k.CardHeader,{children:(0,b.jsx)(k.CardTitle,{children:"Proposal Details"})}),(0,b.jsxs)(k.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-semibold",children:"Proposal Title *"}),(0,b.jsx)(i.Input,{...x("title"),placeholder:"e.g., Website Development for Acme Corp â€” Modern responsive site"}),C.title&&(0,b.jsx)("p",{className:"text-red-600 text-sm mt-1",children:C.title.message})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-semibold",children:"Subtitle / Tagline"}),(0,b.jsx)(i.Input,{...x("subtitle"),placeholder:"Optional: short tagline or project summary (e.g., Improve conversion rate)"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-semibold",children:"Proposal Date *"}),(0,b.jsx)(i.Input,{type:"date",...x("date")})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-semibold",children:"Client *"}),(0,b.jsxs)("select",{...x("clientId"),className:"w-full border rounded px-3 py-2",children:[(0,b.jsx)("option",{value:"",children:"Select client (or create new client in Clients) ..."}),r.map(a=>(0,b.jsx)("option",{value:a._id||a.id,children:a.name},a._id||a.id))]}),C.clientId&&(0,b.jsx)("p",{className:"text-red-600 text-sm mt-1",children:C.clientId.message})]})]})]})]}),(0,b.jsxs)(k.Card,{className:"border-2 border-black",children:[(0,b.jsx)(k.CardHeader,{children:(0,b.jsx)(k.CardTitle,{children:"Project Information"})}),(0,b.jsxs)(k.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-semibold",children:"Objective *"}),(0,b.jsx)(j.Textarea,{...x("objective"),rows:3,placeholder:"Describe the primary objective (e.g., Increase leads by 30%, launch product landing page) Examples: Improve conversion, migrate to headless CMS, launch e-commerce feature"}),C.objective&&(0,b.jsx)("p",{className:"text-red-600 text-sm mt-1",children:C.objective.message})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-semibold",children:"Purpose *"}),(0,b.jsx)(j.Textarea,{...x("purpose"),rows:3,placeholder:"Explain the business purpose and expected outcome (e.g., modernize brand presence, reduce maintenance cost)"}),C.purpose&&(0,b.jsx)("p",{className:"text-red-600 text-sm mt-1",children:C.purpose.message})]})]})]}),(0,b.jsxs)(k.Card,{className:"border-2 border-black",children:[(0,b.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,b.jsx)(k.CardTitle,{children:"Scope of Work"}),(0,b.jsx)(h.Button,{type:"button",size:"sm",onClick:()=>E({value:""}),children:(0,b.jsx)(l.Plus,{className:"h-4 w-4"})})]}),(0,b.jsxs)(k.CardContent,{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-center text-sm font-medium text-gray-600 mb-2",children:[(0,b.jsx)("div",{className:"col-span-11",children:"Scope Item"}),(0,b.jsx)("div",{className:"col-span-1 text-center",children:"Action"})]}),D.map((a,c)=>(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(i.Input,{...x(`scope.${c}.value`),placeholder:"e.g., Design homepage; Implement CMS; Integrate payment gateway"}),(0,b.jsx)(h.Button,{type:"button",variant:"ghost",size:"icon",onClick:()=>F(c),children:(0,b.jsx)(m.Trash2,{className:"h-4 w-4"})})]},a.id))]})]}),(0,b.jsxs)(k.Card,{className:"border-2 border-black",children:[(0,b.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,b.jsx)(k.CardTitle,{children:"Deliverables"}),(0,b.jsx)(h.Button,{type:"button",size:"sm",onClick:()=>H({value:""}),children:(0,b.jsx)(l.Plus,{className:"h-4 w-4"})})]}),(0,b.jsxs)(k.CardContent,{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-center text-sm font-medium text-gray-600 mb-2",children:[(0,b.jsx)("div",{className:"col-span-11",children:"Deliverable"}),(0,b.jsx)("div",{className:"col-span-1 text-center",children:"Action"})]}),G.map((a,c)=>(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(i.Input,{...x(`deliverables.${c}.value`),placeholder:"e.g., Responsive website, Admin dashboard, Deployment to production"}),(0,b.jsx)(h.Button,{type:"button",variant:"ghost",size:"icon",onClick:()=>I(c),children:(0,b.jsx)(m.Trash2,{className:"h-4 w-4"})})]},a.id))]})]}),(0,b.jsxs)(k.Card,{className:"border-2 border-black",children:[(0,b.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,b.jsx)(k.CardTitle,{children:"Project Timeline"}),(0,b.jsx)(h.Button,{type:"button",size:"sm",onClick:()=>K({phase:"",description:"",duration:""}),children:(0,b.jsx)(l.Plus,{className:"h-4 w-4"})})]}),(0,b.jsx)(k.CardContent,{className:"space-y-3",children:J.map((a,c)=>(0,b.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-start",children:[(0,b.jsx)(i.Input,{...x(`timeline.${c}.phase`),placeholder:"e.g., Discovery, Design, Development",className:"col-span-3"}),(0,b.jsx)(i.Input,{...x(`timeline.${c}.description`),placeholder:"Brief description of this phase (responsibilities & output)",className:"col-span-6"}),(0,b.jsx)(i.Input,{...x(`timeline.${c}.duration`),placeholder:"e.g., 2 weeks, 1 month",className:"col-span-2"}),(0,b.jsx)(h.Button,{type:"button",variant:"ghost",size:"icon",onClick:()=>L(c),className:"col-span-1",children:(0,b.jsx)(m.Trash2,{className:"h-4 w-4"})})]},a.id))})]}),(0,b.jsxs)(k.Card,{className:"border-2 border-black",children:[(0,b.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,b.jsx)(k.CardTitle,{children:"Services Breakdown"}),(0,b.jsx)(h.Button,{type:"button",size:"sm",onClick:()=>Q({serviceName:"",qty:1,price:0,total:0}),children:(0,b.jsx)(l.Plus,{className:"h-4 w-4"})})]}),(0,b.jsxs)(k.CardContent,{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-center text-sm font-medium text-gray-600 mb-2",children:[(0,b.jsx)("div",{className:"col-span-5",children:"Service"}),(0,b.jsx)("div",{className:"col-span-2 text-center",children:"Qty"}),(0,b.jsx)("div",{className:"col-span-2 text-right pr-2",children:"Unit Price"}),(0,b.jsx)("div",{className:"col-span-2 text-right pr-2",children:"Total"}),(0,b.jsx)("div",{className:"col-span-1 text-center",children:"Action"})]}),P.map((a,c)=>(0,b.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-start",children:[(0,b.jsx)(i.Input,{...x(`services.${c}.serviceName`),placeholder:"e.g., Frontend Development, SEO Audit",className:"col-span-5"}),(0,b.jsx)(i.Input,{type:"number",...x(`services.${c}.qty`,{valueAsNumber:!0}),placeholder:"Qty (hours/units)",className:"col-span-2"}),(0,b.jsx)(i.Input,{type:"number",...x(`services.${c}.price`,{valueAsNumber:!0}),placeholder:"Unit price (INR)",className:"col-span-2"}),(0,b.jsx)(i.Input,{value:W[c]?.total.toFixed(2)||"0.00",readOnly:!0,className:"col-span-2 bg-gray-50"}),(0,b.jsx)(h.Button,{type:"button",variant:"ghost",size:"icon",onClick:()=>R(c),className:"col-span-1",children:(0,b.jsx)(m.Trash2,{className:"h-4 w-4"})})]},a.id))]})]}),(0,b.jsxs)(k.Card,{className:"border-2 border-black",children:[(0,b.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,b.jsx)(k.CardTitle,{children:"Pricing Breakdown"}),(0,b.jsx)(h.Button,{type:"button",size:"sm",onClick:()=>N({name:"",qty:1,unitPrice:0,tax:0,total:0}),children:(0,b.jsx)(l.Plus,{className:"h-4 w-4"})})]}),(0,b.jsxs)(k.CardContent,{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-center text-sm font-medium text-gray-600 mb-2",children:[(0,b.jsx)("div",{className:"col-span-4",children:"Item / Description"}),(0,b.jsx)("div",{className:"col-span-1 text-center",children:"Qty"}),(0,b.jsx)("div",{className:"col-span-2 text-right pr-2",children:"Unit Price"}),(0,b.jsx)("div",{className:"col-span-1 text-center",children:"Tax %"}),(0,b.jsx)("div",{className:"col-span-3 text-right pr-2",children:"Total"}),(0,b.jsx)("div",{className:"col-span-1 text-center",children:"Action"})]}),M.map((a,c)=>(0,b.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-start",children:[(0,b.jsx)(i.Input,{...x(`lineItems.${c}.name`),placeholder:"e.g., UI Design (40 hours)",className:"col-span-4"}),(0,b.jsx)(i.Input,{type:"number",...x(`lineItems.${c}.qty`,{valueAsNumber:!0}),placeholder:"Qty (e.g., 40)",className:"col-span-1"}),(0,b.jsx)(i.Input,{type:"number",...x(`lineItems.${c}.unitPrice`,{valueAsNumber:!0}),placeholder:"Unit price (e.g., 500)",className:"col-span-2"}),(0,b.jsx)(i.Input,{type:"number",...x(`lineItems.${c}.tax`,{valueAsNumber:!0}),placeholder:"Tax % (e.g., 18)",className:"col-span-1"}),(0,b.jsx)(i.Input,{value:V[c]?.total.toFixed(2)||"0.00",readOnly:!0,className:"col-span-3 bg-gray-50"}),(0,b.jsx)(h.Button,{type:"button",variant:"ghost",size:"icon",onClick:()=>O(c),className:"col-span-1",children:(0,b.jsx)(m.Trash2,{className:"h-4 w-4"})})]},a.id))]})]}),(0,b.jsxs)(k.Card,{className:"border-2 border-black",children:[(0,b.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,b.jsx)(k.CardTitle,{children:"Modules & Features"}),(0,b.jsx)(h.Button,{type:"button",size:"sm",onClick:()=>T({moduleName:"",description:"",status:"Planned"}),children:(0,b.jsx)(l.Plus,{className:"h-4 w-4"})})]}),(0,b.jsxs)(k.CardContent,{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-center text-sm font-medium text-gray-600 mb-2",children:[(0,b.jsx)("div",{className:"col-span-4",children:"Module"}),(0,b.jsx)("div",{className:"col-span-5",children:"Description"}),(0,b.jsx)("div",{className:"col-span-2 text-center",children:"Status"}),(0,b.jsx)("div",{className:"col-span-1 text-center",children:"Action"})]}),S.map((a,c)=>(0,b.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-start",children:[(0,b.jsx)(i.Input,{...x(`modules.${c}.moduleName`),placeholder:"e.g., Blog Module, E-commerce Cart",className:"col-span-4"}),(0,b.jsx)(i.Input,{...x(`modules.${c}.description`),placeholder:"Short description or responsibilities for this module",className:"col-span-5"}),(0,b.jsxs)("select",{...x(`modules.${c}.status`),className:"col-span-2 border rounded px-2 py-2",children:[(0,b.jsx)("option",{value:"Planned",children:"Planned"}),(0,b.jsx)("option",{value:"Ongoing",children:"Ongoing"}),(0,b.jsx)("option",{value:"Completed",children:"Completed"})]}),(0,b.jsx)(h.Button,{type:"button",variant:"ghost",size:"icon",onClick:()=>U(c),className:"col-span-1",children:(0,b.jsx)(m.Trash2,{className:"h-4 w-4"})})]},a.id))]})]}),(0,b.jsxs)(k.Card,{className:"border-2 border-black",children:[(0,b.jsx)(k.CardHeader,{children:(0,b.jsx)(k.CardTitle,{children:"Additional Information"})}),(0,b.jsxs)(k.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-semibold",children:"Notes"}),(0,b.jsx)(j.Textarea,{...x("notes"),rows:3,placeholder:"Additional notes for the client, assumptions, or exclusions"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-semibold",children:"Payment Terms"}),(0,b.jsx)(j.Textarea,{...x("paymentTerms"),rows:2,placeholder:"e.g., 50% advance, 30% on milestone, 20% on delivery. Include invoice schedule and payment methods."})]})]})]}),(0,b.jsxs)("div",{className:"flex gap-4 justify-end",children:[(0,b.jsx)(h.Button,{type:"button",variant:"outline",onClick:()=>a.back(),children:"Cancel"}),(0,b.jsxs)(h.Button,{type:"submit",disabled:t,size:"lg",children:[(0,b.jsx)(n.Save,{className:"mr-2 h-4 w-4"}),t?"Creating...":"Create Quotation"]})]})]})]})}a.s(["default",()=>q])}];

//# sourceMappingURL=7e03e_final-pixelate_dashboard_src_app_%28crm%29_quotations_create_page_tsx_1d828d5b._.js.map