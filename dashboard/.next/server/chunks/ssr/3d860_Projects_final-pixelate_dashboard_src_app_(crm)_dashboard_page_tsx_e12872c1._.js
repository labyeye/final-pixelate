module.exports=[36310,a=>{"use strict";var b=a.i(57457),c=a.i(90782),d=a.i(15404),e=a.i(59104),f=a.i(87299),g=a.i(90132),h=a.i(74978),i=a.i(8852),j=a.i(8533),k=a.i(62012),l=a.i(47344),m=a.i(90537),n=a.i(22693),o=a.i(15557),p=a.i(42317),q=a.i(49818),r=a.i(34798),s=a.i(92805),t=a.i(79192),u=a.i(8084),v="Tabs",[w,x]=(0,o.createContextScope)(v,[p.createRovingFocusGroupScope]),y=(0,p.createRovingFocusGroupScope)(),[z,A]=w(v),B=c.forwardRef((a,c)=>{let{__scopeTabs:d,value:e,onValueChange:f,defaultValue:g,orientation:h="horizontal",dir:i,activationMode:j="automatic",...k}=a,l=(0,s.useDirection)(i),[m,n]=(0,t.useControllableState)({prop:e,onChange:f,defaultProp:g??"",caller:v});return(0,b.jsx)(z,{scope:d,baseId:(0,u.useId)(),value:m,onValueChange:n,orientation:h,dir:l,activationMode:j,children:(0,b.jsx)(r.Primitive.div,{dir:l,"data-orientation":h,...k,ref:c})})});B.displayName=v;var C="TabsList",D=c.forwardRef((a,c)=>{let{__scopeTabs:d,loop:e=!0,...f}=a,g=A(C,d),h=y(d);return(0,b.jsx)(p.Root,{asChild:!0,...h,orientation:g.orientation,dir:g.dir,loop:e,children:(0,b.jsx)(r.Primitive.div,{role:"tablist","aria-orientation":g.orientation,...f,ref:c})})});D.displayName=C;var E="TabsTrigger",F=c.forwardRef((a,c)=>{let{__scopeTabs:d,value:e,disabled:f=!1,...g}=a,h=A(E,d),i=y(d),j=I(h.baseId,e),k=J(h.baseId,e),l=e===h.value;return(0,b.jsx)(p.Item,{asChild:!0,...i,focusable:!f,active:l,children:(0,b.jsx)(r.Primitive.button,{type:"button",role:"tab","aria-selected":l,"aria-controls":k,"data-state":l?"active":"inactive","data-disabled":f?"":void 0,disabled:f,id:j,...g,ref:c,onMouseDown:(0,n.composeEventHandlers)(a.onMouseDown,a=>{f||0!==a.button||!1!==a.ctrlKey?a.preventDefault():h.onValueChange(e)}),onKeyDown:(0,n.composeEventHandlers)(a.onKeyDown,a=>{[" ","Enter"].includes(a.key)&&h.onValueChange(e)}),onFocus:(0,n.composeEventHandlers)(a.onFocus,()=>{let a="manual"!==h.activationMode;l||f||!a||h.onValueChange(e)})})})});F.displayName=E;var G="TabsContent",H=c.forwardRef((a,d)=>{let{__scopeTabs:e,value:f,forceMount:g,children:h,...i}=a,j=A(G,e),k=I(j.baseId,f),l=J(j.baseId,f),m=f===j.value,n=c.useRef(m);return c.useEffect(()=>{let a=requestAnimationFrame(()=>n.current=!1);return()=>cancelAnimationFrame(a)},[]),(0,b.jsx)(q.Presence,{present:g||m,children:({present:c})=>(0,b.jsx)(r.Primitive.div,{"data-state":m?"active":"inactive","data-orientation":j.orientation,role:"tabpanel","aria-labelledby":k,hidden:!c,id:l,tabIndex:0,...i,ref:d,style:{...a.style,animationDuration:n.current?"0s":void 0},children:c&&h})})});function I(a,b){return`${a}-trigger-${b}`}function J(a,b){return`${a}-content-${b}`}H.displayName=G;let K=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)(D,{ref:d,className:(0,e.cn)("inline-flex h-10 items-center justify-center rounded-none bg-muted p-1 text-muted-foreground border-2",a),...c}));K.displayName=D.displayName;let L=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)(F,{ref:d,className:(0,e.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-none px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground",a),...c}));L.displayName=F.displayName;let M=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)(H,{ref:d,className:(0,e.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...c}));M.displayName=H.displayName;var N=a.i(68932);let O=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function P(){let{user:a}=(0,m.useAuth)(),n=a?.role==="staff",[o,p]=(0,c.useState)([]),[q,r]=(0,c.useState)([]),[s,t]=(0,c.useState)([]),[u,v]=(0,c.useState)([]),[w,x]=(0,c.useState)([]),[y,z]=(0,c.useState)([]),[A,C]=(0,c.useState)([]),[D,E]=(0,c.useState)([]);function F({value:a,duration:d=800,currency:e=!1}){let f=(0,c.useRef)(null),[g,h]=(0,c.useState)(0);return(0,c.useEffect)(()=>{let b=null,c=Number(a||0);if(0===c)return void h(c);let e=a=>{b||(b=a);let g=Math.min(d,a-b);h(Math.round(0+g/d*(c-0))),g<d&&(f.current=requestAnimationFrame(e))};return f.current=requestAnimationFrame(e),()=>{f.current&&cancelAnimationFrame(f.current)}},[a,d]),(0,b.jsx)(b.Fragment,{children:e?`₹${Number(g||0).toLocaleString()}`:g})}(0,c.useEffect)(()=>{let a=!0;!async function(){try{let b=localStorage.getItem("auth_token")||"",[c,d,e,f,g,h]=await Promise.all([fetch("/api/projects"),fetch("/api/invoices"),fetch("/api/leads",{headers:b?{Authorization:"Bearer "+b}:{}}),fetch("/api/quotations"),fetch("/api/services"),fetch("/api/expenses")]),[i,j,k,l,m,n]=await Promise.all([c.json(),d.json(),e.json(),f.json(),g.json(),h.json()]);if(!a)return;r(i||[]),t(j||[]),v(n||[]),z(Array.isArray(k)?k:[]),C(l||[]),E(m||[]);let o=await (await fetch("/api/clients")).json();x(o||[]);let q=(o||[]).length||0,s=(i||[]).length||0,u=(j||[]).reduce((a,b)=>a+Number(b.amount||0),0),w=(n||[]).reduce((a,b)=>a+Number(b.amount||0),0);p([{name:"clients",value:q,change:"+1.1%",changeType:"positive"},{name:"projects",value:s,change:"+2.4%",changeType:"positive"},{name:"revenue",value:u,change:"+4.2%",changeType:"positive"},{name:"expense",value:w,change:"-0.8%",changeType:"negative"}])}catch(a){console.error("Failed to load dashboard data",a)}}();let b=b=>{(async()=>{try{if(b?.detail?.invoices){t(b.detail.invoices||[]);let c=await fetch("/api/projects"),d=await c.json();if(!a)return;r(d||[])}else{let[b,c]=await Promise.all([fetch("/api/projects"),fetch("/api/invoices")]),[d,e]=await Promise.all([b.json(),c.json()]);if(!a)return;r(d||[]),t(e||[])}}catch(a){console.error("Failed to refresh dashboard data",a)}})()};return window.addEventListener("data:changed",b),()=>{a=!1,window.removeEventListener("data:changed",b)}},[]);let G=q.reduce((a,b)=>{let c=b.status||"BACKLOG";return a[c]=(a[c]||0)+1,a},{});Object.keys(G).map(a=>({status:a,count:G[a],fill:`hsl(var(--chart-${Object.keys(G).indexOf(a)+1}))`}));let H=y.reduce((a,b)=>{let c=b.status??"NEW";return a[c]=(a[c]||0)+1,a},{});Object.entries(A.filter(a=>"APPROVED"===a.status).flatMap(a=>a.services??[]).reduce((a,b)=>{if(!b)return a;let c=b.name??"Unknown";return a[c]=(a[c]||0)+1,a},{})).map(([a,b])=>({service:a,count:b})).sort((a,b)=>b.count-a.count);let I=(()=>{let a=new Date,b=[];for(let c=5;c>=0;c--){let d=new Date(a.getFullYear(),a.getMonth()-c,1);b.push({month:O[d.getMonth()],revenue:0})}for(let c of s||[]){let d=c.createdAt?new Date(c.createdAt):null;if(!d||Number.isNaN(d.getTime()))continue;let e=(a.getFullYear()-d.getFullYear())*12+(a.getMonth()-d.getMonth());if(e>=0&&e<6){let a=5-e;b[a].revenue+=Number(c.amount||0)}}return b})();(q||[]).filter(a=>"COMPLETED"===a.status).map(a=>({title:a.title,amount:Number(a.amount||0)}));let J=(()=>{if(!a||"staff"!==a.role)return 0;let b=a.id??a._id,c=0;for(let a of q||[])for(let d of a.assignees||[]){let a=d&&(d.id??d._id??d.teamMemberId??d.memberId??d.userId??d);a&&String(a)===String(b)&&(c+=Number(d.payout||0))}return c})(),P=(()=>{if(!a||"staff"!==a.role)return[];let b=a.id??a._id,c=new Map;for(let a of q||[])for(let d of a.assignees||[]){let e=d&&(d.id??d._id??d.teamMemberId??d.memberId??d.userId??d);if(e&&String(e)===String(b)){let b=String(a._id??a.id??a.title),e=a.clientName||"-";try{if(!e||"-"===e)if(a.client&&"object"==typeof a.client&&(a.client.name||a.client.title))e=a.client.name||a.client.title||String(a.client);else if(a.client){let b=(w||[]).find(b=>String(b.id??b._id)===String(a.client));e=b?.name||String(a.client)}else if(a.clientId){let b=(w||[]).find(b=>String(b.id??b._id)===String(a.clientId));e=b?.name||String(a.clientId)}else e="-"}catch(a){e="-"}let f=c.get(b)||{projectId:a._id??a.id??b,title:a.title||"Untitled",payout:0,clientName:e};f.payout+=Number(d.payout||0),f.clientName||(f.clientName=e),c.set(b,f)}}return Array.from(c.values()).sort((a,b)=>b.payout-a.payout)})();return(0,b.jsxs)("div",{className:"space-y-8 font-headline",children:[(0,b.jsxs)("header",{children:[(0,b.jsx)("h1",{className:"text-5xl font-black tracking-tighter",children:"DASHBOARD"}),(0,b.jsx)("p",{className:"text-muted-foreground text-lg",children:"Real-time pulse of your agency."})]}),(0,b.jsxs)(B,{defaultValue:"overview",children:[(0,b.jsx)(K,{className:"grid w-full grid-cols-1 h-auto",children:(0,b.jsx)(L,{value:"overview",className:"h-12 text-lg",children:"Overview"})}),(0,b.jsx)(M,{value:"overview",className:"space-y-8 mt-8",children:n?(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-1 gap-8",children:[(0,b.jsxs)(d.Card,{className:"border-2 border-black",children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{className:"text-2xl font-black tracking-tighter",children:"Leads Pipeline"}),(0,b.jsx)(d.CardDescription,{children:"Current status of all leads."})]}),(0,b.jsx)(d.CardContent,{className:"space-y-4",children:Object.entries(H).map(([a,c])=>(0,b.jsxs)("div",{className:"flex justify-between items-center bg-muted p-3",children:[(0,b.jsx)("span",{className:"font-bold text-muted-foreground text-lg",children:a}),(0,b.jsx)("span",{className:"font-black text-3xl",children:Number(c)})]},a))})]}),(0,b.jsxs)(d.Card,{className:"border-2 border-black",children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{className:"text-2xl font-black tracking-tighter",children:"My Earnings"}),(0,b.jsx)(d.CardDescription,{children:"Total payouts assigned to you across projects"})]}),(0,b.jsx)(d.CardContent,{children:(0,b.jsxs)("p",{className:"text-5xl font-black",children:["₹",Number(J||0).toLocaleString()]})})]}),(0,b.jsxs)(d.Card,{className:"border-2 border-black",children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{className:"text-2xl font-black tracking-tighter",children:"Earnings by Project"}),(0,b.jsx)(d.CardDescription,{children:"Which projects contributed to your earnings"})]}),(0,b.jsx)(d.CardContent,{children:0===P.length?(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"No assigned payouts found"}):(0,b.jsxs)(N.Table,{children:[(0,b.jsx)(N.TableHeader,{children:(0,b.jsxs)(N.TableRow,{children:[(0,b.jsx)(N.TableHead,{children:"Project"}),(0,b.jsx)(N.TableHead,{children:"Client"}),(0,b.jsx)(N.TableHead,{className:"text-right",children:"Payout"})]})}),(0,b.jsx)(N.TableBody,{children:P.map(a=>(0,b.jsxs)(N.TableRow,{children:[(0,b.jsx)(N.TableCell,{className:"font-bold",children:a.title}),(0,b.jsx)(N.TableCell,{children:a.clientName||"-"}),(0,b.jsxs)(N.TableCell,{className:"text-right font-black",children:["₹",Number(a.payout||0).toLocaleString()]})]},String(a.projectId)))})]})})]})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:o.map(a=>(0,b.jsxs)(d.Card,{className:"border-2 border-black",children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsx)(d.CardTitle,{className:"text-base font-bold text-muted-foreground tracking-widest",children:a.name.toUpperCase()})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("p",{className:"text-5xl font-black tracking-tighter",children:"revenue"===a.name||"expense"===a.name?(0,b.jsx)(F,{value:Number(a.value||0),duration:1e3,currency:!0}):"clients"===a.name||"projects"===a.name?(0,b.jsx)(F,{value:Number(a.value||0),duration:900}):a.value}),(0,b.jsx)("p",{className:(0,e.cn)("text-sm font-bold","positive"===a.changeType&&"text-success","negative"===a.changeType&&"text-destructive"),children:a.change})]})]},a.name))}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,b.jsxs)(d.Card,{className:"lg:col-span-2 border-2 border-black",children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{className:"text-2xl font-black tracking-tighter",children:"Recent Invoices"}),(0,b.jsx)(d.CardDescription,{children:"A quick look at the latest billing activity."})]}),(0,b.jsx)(d.CardContent,{children:(0,b.jsxs)(N.Table,{children:[(0,b.jsx)(N.TableHeader,{children:(0,b.jsxs)(N.TableRow,{children:[(0,b.jsx)(N.TableHead,{children:"Invoice ID"}),(0,b.jsx)(N.TableHead,{children:"Client"}),(0,b.jsx)(N.TableHead,{children:"Project / Title"}),(0,b.jsx)(N.TableHead,{children:"Amount"}),(0,b.jsx)(N.TableHead,{className:"text-right",children:"Status"})]})}),(0,b.jsx)(N.TableBody,{children:s.slice(0,4).map(a=>(0,b.jsxs)(N.TableRow,{children:[(0,b.jsx)(N.TableCell,{className:"font-bold",children:a.id}),(0,b.jsx)(N.TableCell,{children:a.client||a.clientName||"-"}),(0,b.jsx)(N.TableCell,{children:a.clientName||a.client||w.find(b=>String(b.id??b._id)===String(a.clientId))?.name||"-"}),(0,b.jsx)(N.TableCell,{children:a.title||a.projectTitle||"-"}),(0,b.jsxs)(N.TableCell,{children:["₹",Number(a.amount||0).toLocaleString()]}),(0,b.jsx)(N.TableCell,{className:"text-right font-bold",children:a.status})]},a.id))})]})})]}),(0,b.jsxs)(d.Card,{className:"border-2 border-black",children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{className:"text-2xl font-black tracking-tighter",children:"Leads Pipeline"}),(0,b.jsx)(d.CardDescription,{children:"Current status of all leads."})]}),(0,b.jsx)(d.CardContent,{className:"space-y-4",children:Object.entries(H).map(([a,c])=>(0,b.jsxs)("div",{className:"flex justify-between items-center bg-muted p-3",children:[(0,b.jsx)("span",{className:"font-bold text-muted-foreground text-lg",children:a}),(0,b.jsx)("span",{className:"font-black text-3xl",children:(0,b.jsx)(F,{value:Number(c),duration:700})})]},a))})]})]})]})}),!n&&(0,b.jsx)("div",{className:"space-y-8 mt-8",children:(0,b.jsxs)(d.Card,{className:"lg:col-span-2 border-2 border-black",children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsx)(d.CardTitle,{className:"text-2xl font-black tracking-tighter",children:"MONTHLY REVENUE"})}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("div",{className:"h-[350px] w-full",children:(0,b.jsx)(i.ResponsiveContainer,{width:"100%",height:"100%",children:(0,b.jsxs)(g.BarChart,{data:I,margin:{top:5,right:20,left:-10,bottom:5},children:[(0,b.jsx)(h.CartesianGrid,{strokeDasharray:"3 3",stroke:"hsl(var(--foreground))",opacity:.2}),(0,b.jsx)(j.XAxis,{dataKey:"month",stroke:"hsl(var(--foreground))",fontSize:12,tickLine:!1,axisLine:!1}),(0,b.jsx)(k.YAxis,{stroke:"hsl(var(--foreground))",fontSize:12,tickLine:!1,axisLine:!1,tickFormatter:a=>`₹${a/1e3}k`}),(0,b.jsx)(f.Bar,{dataKey:"revenue",radius:[4,4,0,0],children:I.map((a,c)=>(0,b.jsx)(l.Cell,{fill:["#0ea5e9","#7c3aed","#ef4444","#f59e0b","#10b981","#06b6d4"][c%6]},a.month))})]})})})})]})})]})]})}a.s(["default",()=>P],36310)}];

//# sourceMappingURL=3d860_Projects_final-pixelate_dashboard_src_app_%28crm%29_dashboard_page_tsx_e12872c1._.js.map