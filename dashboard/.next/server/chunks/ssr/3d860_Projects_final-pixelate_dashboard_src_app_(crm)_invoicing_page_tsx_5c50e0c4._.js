module.exports=[96908,a=>{"use strict";var b=a.i(57457),c=a.i(68932),d=a.i(59104),e=a.i(73647),f=a.i(90782),g=a.i(1689),h=a.i(63420),i=a.i(42379),j=a.i(24231);let k={src:a.i(5626).default,width:1200,height:1200,blurWidth:8,blurHeight:8,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAi0lEQVR42o2PMQuCYBCGHxM/P4vS9EsbhBpcjISmCPoxbQmtNbQV9EeCln6mJ4KLgh73wnPcM9zB2LKkQ0Uo8a0+4RhxehV83gU34UNHKDOu/zNfyU+47Ag7n+yRc7nnPIX37WLusEg0SZ3tjE06JRVex5pY22g8G68+zrisIhcTOATLZjZqghr8rgJ1EA4R//85uAAAAABJRU5ErkJggg=="};var l=a.i(48531),m=a.i(58407);function n(a){try{return new Date(a).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"})}catch(b){return String(a||"")}}function o({invoice:a,client:c}){let[d,e]=(0,f.useState)(c);(0,f.useEffect)(()=>{let b=!0;return!d&&a?.clientId&&(async()=>{try{let c=await fetch(`https://backend.pixelatenest.com/api/clients/${a.clientId}`);if(!b)return;if(c.ok){let a=await c.json();e(a)}}catch(a){}})(),()=>{b=!1}},[a,d]);let g=a?Array.isArray(a.items)&&a.items.length?a.items:Array.isArray(a.lineItems)&&a.lineItems.length?a.lineItems:a.amount&&!Array.isArray(a.items)?[{description:a.title||a.projectTitle||"Service",quantity:1,price:Number(a.amount)}]:[]:[],h=g.reduce((a,b)=>a+Number(b?.quantity??b?.qty??1)*Number(b?.price??b?.unitPrice??b?.amount??0),0),i=Number(a?.discount??0)||0,j=Number(a?.tax??0)||0,o=h-i+j,p=Number(a?.paidAmount??a?.paid??0)||0,q="DUE",r="#e65200";p>=o&&o>0?(q="PAID",r="#16a34a"):p>0&&p<o&&(q="PARTIAL",r="#f59e0b");let s=d?.name||a?.clientName||a?.client||"Client";return(0,b.jsxs)("div",{style:{fontFamily:"'Inter', 'Segoe UI', sans-serif",width:"100%",padding:"15mm 20mm",color:"#333",background:"#fff",boxSizing:"border-box",maxWidth:"210mm",minHeight:"297mm",margin:"0 auto"},children:[(0,b.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:20},children:[(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,b.jsx)("div",{style:{width:60,height:60,background:"#e65200",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,b.jsx)("img",{src:"string"==typeof k?k:k.src,alt:"Logo",style:{width:45,height:45,objectFit:"contain",filter:"brightness(0) invert(1)"}})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{style:{fontSize:22,fontWeight:800,color:"#e65200"},children:"Pixelate Nest"}),(0,b.jsx)("div",{style:{fontSize:12,color:"#666",marginTop:2},children:"Kalahanu Tech Studios"})]})]}),(0,b.jsxs)("div",{style:{textAlign:"right"},children:[(0,b.jsx)("div",{style:{fontSize:26,fontWeight:800,color:"#e65200"},children:"TAX INVOICE"}),(0,b.jsxs)("div",{style:{marginTop:8,display:"flex",justifyContent:"flex-end",alignItems:"center",gap:12},children:[(0,b.jsx)("div",{style:{display:"inline-block",padding:"6px 10px",borderRadius:8,background:r,color:"#fff",fontWeight:800,fontSize:12},children:q}),(0,b.jsxs)("div",{style:{fontSize:11,color:"#666",marginTop:0,textAlign:"right"},children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Paid:"})," ",(0,m.formatCurrency)(p)]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Total:"})," ",(0,m.formatCurrency)(o)]})]})]}),(0,b.jsxs)("div",{style:{fontSize:11,color:"#666",marginTop:4},children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Invoice #:"})," ",a?.id??a?.invoiceNo??a?._id]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Date:"})," ",n(a?.createdAt??Date.now())]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("strong",{children:"Due:"})," ",a?.dueDate?n(a.dueDate):"On receipt"]})]})]})]}),(0,b.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:30,marginBottom:20},children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{style:{fontSize:11,fontWeight:600,color:"#e65200",textTransform:"uppercase",marginBottom:6},children:"From"}),(0,b.jsx)("div",{style:{fontSize:14,fontWeight:700,color:"#333"},children:"Pixelate Nest"}),(0,b.jsx)("div",{style:{fontSize:11,color:"#666",marginTop:3},children:"GST: 10AADCK1491R2ZB"}),(0,b.jsx)("div",{style:{fontSize:11,color:"#666",marginTop:3},children:"Kala Bhawan, Akharaghat Road"}),(0,b.jsx)("div",{style:{fontSize:11,color:"#666",marginTop:3},children:"Muzaffarpur, Bihar - 842001"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{style:{fontSize:11,fontWeight:600,color:"#e65200",textTransform:"uppercase",marginBottom:6},children:"Bill To"}),(0,b.jsx)("div",{style:{fontSize:14,fontWeight:700,color:"#333",marginBottom:4},children:s}),(0,b.jsx)("div",{style:{fontSize:11,color:"#666",marginBottom:3},children:d?.address||a?.clientAddress||""}),(0,b.jsx)("div",{style:{fontSize:11,color:"#666"},children:d?.email||a?.clientEmail||""}),(0,b.jsx)("div",{style:{fontSize:11,color:"#666"},children:d?.phone||a?.clientPhone||""})]})]}),(0,b.jsx)("div",{style:{marginBottom:20},children:(0,b.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{style:{background:"#e65200",color:"#fff"},children:[(0,b.jsx)("th",{style:{padding:"10px 12px",textAlign:"left",fontWeight:600,fontSize:11},children:"#"}),(0,b.jsx)("th",{style:{padding:"10px 12px",textAlign:"left",fontWeight:600,fontSize:11},children:"Description"}),(0,b.jsx)("th",{style:{padding:"10px 12px",textAlign:"right",fontWeight:600,fontSize:11},children:"Qty"}),(0,b.jsx)("th",{style:{padding:"10px 12px",textAlign:"right",fontWeight:600,fontSize:11},children:"Unit Price"}),(0,b.jsx)("th",{style:{padding:"10px 12px",textAlign:"right",fontWeight:600,fontSize:11},children:"Amount"})]})}),(0,b.jsx)("tbody",{children:g.slice(0,8).map((a,c)=>{let d=Number(a?.quantity??a?.qty??1),e=Number(a?.price??a?.unitPrice??a?.amount??0);return(0,b.jsxs)("tr",{style:{borderBottom:"1px solid #eee"},children:[(0,b.jsx)("td",{style:{padding:"10px 12px",fontWeight:500,color:"#666"},children:c+1}),(0,b.jsx)("td",{style:{padding:"10px 12px",fontWeight:500},children:a?.description||a?.name||"Service"}),(0,b.jsx)("td",{style:{padding:"10px 12px",textAlign:"right",fontWeight:500,color:"#666"},children:d}),(0,b.jsx)("td",{style:{padding:"10px 12px",textAlign:"right",fontWeight:500,color:"#666"},children:(0,m.formatCurrency)(e)}),(0,b.jsx)("td",{style:{padding:"10px 12px",textAlign:"right",fontWeight:600,color:"#333"},children:(0,m.formatCurrency)(d*e)})]},c)})})]})}),(0,b.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:40,marginBottom:25},children:[(0,b.jsxs)("div",{style:{flex:1},children:[(0,b.jsx)("div",{style:{fontSize:11,fontWeight:600,color:"#e65200",textTransform:"uppercase",marginBottom:10},children:"Notes"}),(0,b.jsx)("div",{style:{fontSize:11,color:"#666",lineHeight:1.5},children:a?.notes||"Payment due within 30 days of invoice date. Please include invoice number with payment."})]}),(0,b.jsxs)("div",{style:{width:280,padding:15,border:"1px solid #eee"},children:[(0,b.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[(0,b.jsx)("span",{style:{fontSize:12,color:"#666"},children:"Subtotal"}),(0,b.jsx)("span",{style:{fontSize:12,fontWeight:600,color:"#333"},children:(0,m.formatCurrency)(h)})]}),i>0&&(0,b.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[(0,b.jsx)("span",{style:{fontSize:12,color:"#666"},children:"Discount"}),(0,b.jsxs)("span",{style:{fontSize:12,fontWeight:600,color:"#333"},children:["- ",(0,m.formatCurrency)(i)]})]}),j>0&&(0,b.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:12},children:[(0,b.jsx)("span",{style:{fontSize:12,color:"#666"},children:"Tax"}),(0,b.jsx)("span",{style:{fontSize:12,fontWeight:600,color:"#333"},children:(0,m.formatCurrency)(j)})]}),(0,b.jsxs)("div",{style:{paddingTop:12,borderTop:"2px solid #e65200",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,b.jsx)("span",{style:{fontSize:14,fontWeight:700,color:"#e65200"},children:"Total"}),(0,b.jsx)("span",{style:{fontSize:18,fontWeight:800,color:"#e65200"},children:(0,m.formatCurrency)(o)})]})]})]}),(0,b.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:20,marginBottom:20,paddingTop:20,borderTop:"1px solid #eee"},children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{style:{fontSize:11,fontWeight:600,color:"#e65200",textTransform:"uppercase",marginBottom:8},children:"Payment Info"}),(0,b.jsxs)("div",{style:{fontSize:11,color:"#666",lineHeight:1.5},children:[(0,b.jsx)("div",{children:"Bank: HDFC BANK PVT LTD"}),(0,b.jsx)("div",{children:"A/C: 0000 1234 5678"}),(0,b.jsx)("div",{children:"Name: Kalahanu Tech Studios"}),(0,b.jsx)("div",{children:"IFSC: HDFC0001234"})]})]}),(0,b.jsxs)("div",{style:{textAlign:"center",alignItems:"center"},children:[(0,b.jsx)("img",{src:"string"==typeof l.default?l.default:l.default.src,alt:"Signature",style:{width:"180px",height:"100px",objectFit:"contain"}}),(0,b.jsx)("div",{style:{height:1,width:"100%",backgroundColor:"#e65200",margin:"0 auto 6px",opacity:.5}}),(0,b.jsx)("div",{style:{fontSize:12,fontWeight:700,color:"#333"},children:"Labh Chandra Bothra"}),(0,b.jsx)("div",{style:{fontSize:11,color:"#666"},children:"Co-Founder"})]}),(0,b.jsxs)("div",{style:{textAlign:"right"},children:[(0,b.jsx)("div",{style:{fontSize:11,fontWeight:600,color:"#e65200",textTransform:"uppercase",marginBottom:8},children:"Contact"}),(0,b.jsxs)("div",{style:{fontSize:11,color:"#666",lineHeight:1.5},children:[(0,b.jsx)("div",{children:"ðŸ“§ support@pixelatenest.com"}),(0,b.jsx)("div",{children:"ðŸ“ž +91 9234112345"}),(0,b.jsx)("div",{children:"ðŸŒ pixelatenest.com"})]})]})]}),(0,b.jsx)("div",{style:{fontSize:10,color:"#666",textAlign:"center",paddingTop:15,borderTop:"1px solid #eee"},children:"This invoice is computer generated and does not require a signature. All goods and services remain the property of Pixelate Nest until paid in full."})]})}var p=a.i(36553),q=a.i(70575);function r({clients:c,services:d,projects:k,onCreated:l}){let[m,n]=f.default.useState(!1),r=(0,j.useForm)({defaultValues:{clientId:"",serviceId:"",projectTitle:"",title:"",amount:0,dueDate:"",invoiceNo:""}}),s=async d=>{try{let e={clientId:d.clientId||null,clientName:c.find(a=>String(a.id??a._id)===String(d.clientId))?.name||"",serviceId:d.serviceId||null,invoiceNo:d.invoiceNo||void 0,projectTitle:d.projectTitle||d.title||"",title:d.title||d.projectTitle||"Invoice",amount:Number(d.amount||0),dueDate:d.dueDate||"",status:"DUE",createdAt:new Date},f=await fetch("/api/invoices",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}});if(!f.ok)throw Error("Failed to create invoice");let g=await f.json(),h=new p.default({unit:"mm",format:"a4",orientation:"portrait"});try{let c,{loadNotoSansForJsPDF:d}=await a.A(41865),f=await d(h,"NotoSans");if(f)try{h.setFont(f)}catch(a){}let i=(0,q.renderToString)((0,b.jsx)(o,{invoice:{...g,...e}})),j="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;700&display=swap";try{let a=await fetch("/fonts/NotoSans-Regular.ttf");if(a&&a.ok){let b=await a.arrayBuffer(),d=new Uint8Array(b),e="";for(let a=0;a<d.length;a+=32768)e+=String.fromCharCode.apply(null,Array.from(d.slice(a,a+32768)));let f="undefined"!=typeof btoa?btoa(e):Buffer.from(e,"binary").toString("base64"),g=`
<style>
@font-face { font-family: 'Noto Sans Local'; src: url('data:font/truetype;base64,${f}') format('truetype'); font-weight: 400; font-style: normal; font-display: swap; }
</style>
`;c=`${g}<link href="${j}" rel="stylesheet"><div style="width:100%;height:100%;margin:0;padding:0;box-sizing:border-box;">${i}</div>`}else{let a=`
<style>
@font-face { font-family: 'Noto Sans Local'; src: url('/fonts/NotoSans-Regular.ttf') format('truetype'); font-weight: 400; font-style: normal; font-display: swap; }
@font-face { font-family: 'Noto Sans Local'; src: url('/fonts/NotoSans-Bold.ttf') format('truetype'); font-weight: 700; font-style: normal; font-display: swap; }
</style>
`;c=`${a}<link href="${j}" rel="stylesheet"><div style="width:100%;height:100%;margin:0;padding:0;box-sizing:border-box;font-family:'Noto Sans Local','Noto Sans',${f||"sans-serif"};">${i}</div>`}}catch(a){c=`<link href="${j}" rel="stylesheet"><div style="width:100%;height:100%;margin:0;padding:0;box-sizing:border-box;font-family:'Noto Sans',${f||"sans-serif"};">${i}</div>`}let k=c.replace(/â‚¹/g,"Rs."),l=h.internal.pageSize.getWidth();h.internal.pageSize.getHeight(),h.html(k,{callback:function(a){let b=g.id??g.invoiceNo??g._id,c=g.clientName||e.clientName||"",d=String(c||"Client").replace(/[\\/:*?"<>|\s]+/g,"_").replace(/^_+|_+$/g,""),f=`${b}_${d}.pdf`;a.save(f)},x:0,y:0,width:l,windowWidth:1200})}catch(f){let a=(0,q.renderToString)((0,b.jsx)(o,{invoice:{...g,...e}})),c=String(a).replace(/â‚¹/g,"Rs."),d=h.internal.pageSize.getWidth();h.html(c,{callback:function(a){let b=g.id??g.invoiceNo??g._id,c=g.clientName||e.clientName||"",d=String(c||"Client").replace(/[\\/:*?"<>|\s]+/g,"_").replace(/^_+|_+$/g,""),f=`${b}_${d}.pdf`;a.save(f)},x:0,y:0,width:d,windowWidth:1200})}n(!1),r.reset(),l&&l()}catch(a){console.error(a)}};return(0,b.jsxs)(g.Dialog,{open:m,onOpenChange:n,children:[(0,b.jsx)(g.DialogTrigger,{asChild:!0,children:(0,b.jsx)(e.Button,{size:"lg",onClick:()=>n(!0),children:"New Invoice"})}),(0,b.jsxs)(g.DialogContent,{children:[(0,b.jsx)(g.DialogHeader,{children:(0,b.jsx)(g.DialogTitle,{children:"Create Invoice"})}),(0,b.jsx)(i.Form,{...r,children:(0,b.jsxs)("form",{onSubmit:r.handleSubmit(s),className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsx)(i.FormField,{name:"invoiceNo",control:r.control,render:({field:a})=>(0,b.jsxs)(i.FormItem,{children:[(0,b.jsx)(i.FormLabel,{children:"Invoice No"}),(0,b.jsx)(i.FormControl,{children:(0,b.jsx)(h.Input,{...a,placeholder:"Optional - INV-00001"})})]})}),(0,b.jsx)(i.FormField,{name:"clientId",control:r.control,render:({field:a})=>(0,b.jsxs)(i.FormItem,{children:[(0,b.jsx)(i.FormLabel,{children:"Client"}),(0,b.jsx)(i.FormControl,{children:(0,b.jsxs)("select",{...a,className:"w-full border p-2",children:[(0,b.jsx)("option",{value:"",children:"Select client"}),c.map(a=>(0,b.jsx)("option",{value:String(a.id??a._id),children:a.name},String(a.id??a._id)))]})})]})}),(0,b.jsx)(i.FormField,{name:"projectTitle",control:r.control,render:({field:a})=>(0,b.jsxs)(i.FormItem,{children:[(0,b.jsx)(i.FormLabel,{children:"Project Title"}),(0,b.jsx)(i.FormControl,{children:(0,b.jsx)(h.Input,{...a})})]})}),(0,b.jsx)(i.FormField,{name:"title",control:r.control,render:({field:a})=>(0,b.jsxs)(i.FormItem,{children:[(0,b.jsx)(i.FormLabel,{children:"Invoice Title"}),(0,b.jsx)(i.FormControl,{children:(0,b.jsx)(h.Input,{...a})})]})}),(0,b.jsx)(i.FormField,{name:"amount",control:r.control,render:({field:a})=>(0,b.jsxs)(i.FormItem,{children:[(0,b.jsx)(i.FormLabel,{children:"Amount (â‚¹)"}),(0,b.jsx)(i.FormControl,{children:(0,b.jsx)(h.Input,{type:"number",...a})})]})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsx)(i.FormField,{name:"dueDate",control:r.control,render:({field:a})=>(0,b.jsxs)(i.FormItem,{children:[(0,b.jsx)(i.FormLabel,{children:"Due Date"}),(0,b.jsx)(i.FormControl,{children:(0,b.jsx)(h.Input,{type:"date",...a})})]})}),(0,b.jsx)(i.FormField,{name:"serviceId",control:r.control,render:({field:a})=>(0,b.jsxs)(i.FormItem,{children:[(0,b.jsx)(i.FormLabel,{children:"Service"}),(0,b.jsx)(i.FormControl,{children:(0,b.jsxs)("select",{...a,className:"w-full border p-2",children:[(0,b.jsx)("option",{value:"",children:"Select service"}),d.map(a=>(0,b.jsx)("option",{value:String(a.id??a._id),children:a.name},String(a.id??a._id)))]})})]})})]}),(0,b.jsx)(g.DialogFooter,{children:(0,b.jsx)(e.Button,{type:"submit",size:"lg",className:"w-full",children:"Create & Download PDF"})})]})})]})]})}let s=function({invoice:a,clients:c,services:d,projects:k,onUpdated:l}){let[m,n]=f.default.useState(!1),o=(0,j.useForm)({defaultValues:{clientId:"",projectTitle:"",title:"",amount:0,dueDate:"",serviceId:"",status:"",invoiceNo:""}});f.default.useEffect(()=>{m&&a&&o.reset({clientId:String(a.clientId??a.client??a.clientName??""),invoiceNo:a.invoiceNo??a.invoiceNo??"",projectTitle:a.projectTitle??a.title??"",title:a.title??a.projectTitle??"",amount:a.amount??0,dueDate:a.dueDate?new Date(a.dueDate).toISOString().slice(0,10):"",serviceId:String(a.serviceId??""),status:a.status??"DUE"})},[m,a]);let p=async b=>{try{let d={clientId:b.clientId||null,clientName:c.find(a=>String(a.id??a._id)===String(b.clientId))?.name||"",invoiceNo:b.invoiceNo||void 0,projectTitle:b.projectTitle||b.title||"",title:b.title||b.projectTitle||"Invoice",amount:Number(b.amount||0),dueDate:b.dueDate||"",serviceId:b.serviceId||null,status:b.status||"DUE"};if(!(await fetch(`/api/invoices/${a._id??a.id}`,{method:"PUT",body:JSON.stringify(d),headers:{"Content-Type":"application/json"}})).ok)throw Error("Failed to update invoice");n(!1),l&&l()}catch(a){console.error("Failed to save invoice",a)}};return(0,b.jsxs)(g.Dialog,{open:m,onOpenChange:n,children:[(0,b.jsx)(g.DialogTrigger,{asChild:!0,children:(0,b.jsx)(e.Button,{size:"sm",children:"Edit"})}),(0,b.jsxs)(g.DialogContent,{children:[(0,b.jsx)(g.DialogHeader,{children:(0,b.jsx)(g.DialogTitle,{children:"Edit Invoice"})}),(0,b.jsx)(i.Form,{...o,children:(0,b.jsxs)("form",{onSubmit:o.handleSubmit(p),className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsx)(i.FormField,{name:"invoiceNo",control:o.control,render:({field:a})=>(0,b.jsxs)(i.FormItem,{children:[(0,b.jsx)(i.FormLabel,{children:"Invoice No"}),(0,b.jsx)(i.FormControl,{children:(0,b.jsx)(h.Input,{...a,placeholder:"INV-00001"})})]})}),(0,b.jsx)(i.FormField,{name:"clientId",control:o.control,render:({field:a})=>(0,b.jsxs)(i.FormItem,{children:[(0,b.jsx)(i.FormLabel,{children:"Client"}),(0,b.jsx)(i.FormControl,{children:(0,b.jsxs)("select",{...a,className:"w-full border p-2",children:[(0,b.jsx)("option",{value:"",children:"Select client"}),c.map(a=>(0,b.jsx)("option",{value:String(a.id??a._id),children:a.name},String(a.id??a._id)))]})})]})}),(0,b.jsx)(i.FormField,{name:"projectTitle",control:o.control,render:({field:a})=>(0,b.jsxs)(i.FormItem,{children:[(0,b.jsx)(i.FormLabel,{children:"Project Title"}),(0,b.jsx)(i.FormControl,{children:(0,b.jsx)(h.Input,{...a})})]})}),(0,b.jsx)(i.FormField,{name:"title",control:o.control,render:({field:a})=>(0,b.jsxs)(i.FormItem,{children:[(0,b.jsx)(i.FormLabel,{children:"Invoice Title"}),(0,b.jsx)(i.FormControl,{children:(0,b.jsx)(h.Input,{...a})})]})}),(0,b.jsx)(i.FormField,{name:"amount",control:o.control,render:({field:a})=>(0,b.jsxs)(i.FormItem,{children:[(0,b.jsx)(i.FormLabel,{children:"Amount (â‚¹)"}),(0,b.jsx)(i.FormControl,{children:(0,b.jsx)(h.Input,{type:"number",...a})})]})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsx)(i.FormField,{name:"dueDate",control:o.control,render:({field:a})=>(0,b.jsxs)(i.FormItem,{children:[(0,b.jsx)(i.FormLabel,{children:"Due Date"}),(0,b.jsx)(i.FormControl,{children:(0,b.jsx)(h.Input,{type:"date",...a})})]})}),(0,b.jsx)(i.FormField,{name:"serviceId",control:o.control,render:({field:a})=>(0,b.jsxs)(i.FormItem,{children:[(0,b.jsx)(i.FormLabel,{children:"Service"}),(0,b.jsx)(i.FormControl,{children:(0,b.jsxs)("select",{...a,className:"w-full border p-2",children:[(0,b.jsx)("option",{value:"",children:"Select service"}),d.map(a=>(0,b.jsx)("option",{value:String(a.id??a._id),children:a.name},String(a.id??a._id)))]})})]})})]}),(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,b.jsx)(i.FormField,{name:"status",control:o.control,render:({field:a})=>(0,b.jsxs)(i.FormItem,{children:[(0,b.jsx)(i.FormLabel,{children:"Status"}),(0,b.jsx)(i.FormControl,{children:(0,b.jsxs)("select",{...a,className:"w-full border p-2",children:[(0,b.jsx)("option",{value:"DUE",children:"DUE"}),(0,b.jsx)("option",{value:"PAID",children:"PAID"}),(0,b.jsx)("option",{value:"OVERDUE",children:"OVERDUE"})]})})]})})}),(0,b.jsx)(g.DialogFooter,{children:(0,b.jsx)(e.Button,{type:"submit",size:"lg",className:"w-full",children:"Save"})})]})})]})]})},t=function({invoice:a,onRecorded:c}){let[d,k]=f.default.useState(!1),l=(0,j.useForm)({defaultValues:{amount:"",note:""}});if(a?.status==="PAID")return null;f.default.useEffect(()=>{d&&l.reset({amount:"",note:""})},[d]);let m=async b=>{try{let d=Number(b.amount||0);if(!d||d<=0)return void alert("Enter a valid amount");let e=Array.isArray(a.payments)?a.payments.slice():[],f={amount:d,note:b.note||"",date:new Date},g=[...e,f],h=Number(a.paidAmount||0)+d,i=h>=Number(a.amount||0)?"PAID":"PARTIAL";if(!(await fetch(`/api/invoices/${a._id??a.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({payments:g,paidAmount:h,status:i})})).ok)throw Error("Failed to record payment");k(!1),c&&c()}catch(a){console.error("Record payment failed",a),alert("Failed to record payment")}};return(0,b.jsxs)(g.Dialog,{open:d,onOpenChange:k,children:[(0,b.jsx)(g.DialogTrigger,{asChild:!0,children:(0,b.jsx)(e.Button,{size:"sm",children:"Record payment"})}),(0,b.jsxs)(g.DialogContent,{children:[(0,b.jsx)(g.DialogHeader,{children:(0,b.jsx)(g.DialogTitle,{children:"Record Payment"})}),(0,b.jsx)(i.Form,{...l,children:(0,b.jsxs)("form",{onSubmit:l.handleSubmit(m),className:"space-y-4",children:[(0,b.jsx)(i.FormField,{name:"amount",control:l.control,render:({field:a})=>(0,b.jsxs)(i.FormItem,{children:[(0,b.jsx)(i.FormLabel,{children:"Amount (â‚¹)"}),(0,b.jsx)(i.FormControl,{children:(0,b.jsx)(h.Input,{...a,type:"number"})})]})}),(0,b.jsx)(i.FormField,{name:"note",control:l.control,render:({field:a})=>(0,b.jsxs)(i.FormItem,{children:[(0,b.jsx)(i.FormLabel,{children:"Note"}),(0,b.jsx)(i.FormControl,{children:(0,b.jsx)(h.Input,{...a})})]})}),(0,b.jsx)(g.DialogFooter,{children:(0,b.jsx)(e.Button,{type:"submit",size:"lg",className:"w-full",children:"Save Payment"})})]})})]})]})};function u(){let[a,h]=(0,f.useState)([]),[i,j]=(0,f.useState)([]),[k,l]=(0,f.useState)([]),[m,n]=(0,f.useState)([]),[u,v]=(0,f.useState)({}),[w,x]=(0,f.useState)(null),[y,z]=(0,f.useState)(!1);(0,f.useEffect)(()=>{let a=!0;return(async()=>{try{let b=await fetch("/api/invoices");if(!b.ok)throw Error(`Failed to fetch invoices: ${b.status}`);let c=await b.json();a&&h(c)}catch(a){console.error("Failed to load invoices",a)}})(),(async()=>{try{let[b,c,d]=await Promise.all([fetch("/api/clients"),fetch("/api/services"),fetch("/api/projects")]),[e,f,g]=await Promise.all([b.json(),c.json(),d.json()]);a&&(j(e||[]),l(f||[]),n(g||[]))}catch(a){console.error("Failed to load invoice helpers",a)}})(),()=>{a=!1}},[]);let A=async()=>{try{let a=await fetch("/api/invoices");if(!a.ok)throw Error("Failed to fetch invoices");let b=await a.json();h(b)}catch(a){console.error(a)}},B=async a=>{x(a)},C=async a=>{let c=String(a._id??a.id??Date.now()),d=String(a.clientName||a.client||i.find(b=>String(b.id??b._id)===String(a.clientId))?.name||"Client").replace(/[^a-z0-9\-\_ ]/gi,"").trim().replace(/\s+/g,"-").slice(0,120),e=`Invoice-${d}-${c}.pdf`;try{z(!0),v(a=>({...a,[c]:!0}));let d=(0,q.renderToString)((0,b.jsx)(o,{invoice:a,client:i.find(b=>String(b.id??b._id)===String(a.clientId))})),f=new p.default;await f.html(d,{callback:function(a){a.save(e)},x:10,y:10,width:180,windowWidth:800})}catch(a){console.error("Failed to generate PDF",a)}finally{z(!1),v(a=>{let b={...a};return delete b[c],b}),x(null)}};return(0,b.jsxs)("div",{className:"space-y-8 font-headline",children:[(0,b.jsxs)("header",{className:"flex items-center justify-between gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-5xl font-black tracking-tighter",children:"INVOICING"}),(0,b.jsx)("p",{className:"text-muted-foreground text-lg",children:"Manage and track all client invoices."})]}),(0,b.jsx)(r,{clients:i,services:k,projects:m,onCreated:A})]}),(0,b.jsx)("div",{className:"border-2 border-black",children:(0,b.jsxs)(c.Table,{children:[(0,b.jsx)(c.TableHeader,{children:(0,b.jsxs)(c.TableRow,{className:"border-b-2 border-black",children:[(0,b.jsx)(c.TableHead,{className:"text-base font-bold",children:"Invoice No"}),(0,b.jsx)(c.TableHead,{className:"text-base font-bold",children:"Client"}),(0,b.jsx)(c.TableHead,{className:"text-base font-bold",children:"Project / Title"}),(0,b.jsx)(c.TableHead,{className:"text-base font-bold",children:"Amount"}),(0,b.jsx)(c.TableHead,{className:"text-base font-bold",children:"Paid"}),(0,b.jsx)(c.TableHead,{className:"text-base font-bold",children:"Due Date"}),(0,b.jsx)(c.TableHead,{className:"text-right text-base font-bold",children:"Status"}),(0,b.jsx)(c.TableHead,{className:"text-right text-base font-bold",children:"Actions"})]})}),(0,b.jsx)(c.TableBody,{children:a.map(a=>(0,b.jsxs)(c.TableRow,{className:"border-b-2 border-black last:border-b-0",children:[(0,b.jsx)(c.TableCell,{className:"font-bold text-base py-4",children:a.invoiceNo??a.id??a._id}),(0,b.jsx)(c.TableCell,{className:"text-base py-4",children:a.clientName||a.client||i.find(b=>String(b.id??b._id)===String(a.clientId))?.name||"-"}),(0,b.jsx)(c.TableCell,{className:"text-base py-4",children:a.title??a.projectTitle??"-"}),(0,b.jsxs)(c.TableCell,{className:"text-base py-4",children:["â‚¹",(a.amount??0).toLocaleString()]}),(0,b.jsxs)(c.TableCell,{className:"text-base py-4",children:["â‚¹",(a.paidAmount??0).toLocaleString()]}),(0,b.jsx)(c.TableCell,{className:"text-base py-4",children:a.dueDate?new Date(a.dueDate).toLocaleDateString():""}),(0,b.jsx)(c.TableCell,{className:"text-right py-4",children:(0,b.jsx)("span",{className:(0,d.cn)("text-xl font-black tracking-widest p-2","PAID"===a.status&&"bg-success text-success-foreground","DUE"===a.status&&"bg-destructive text-destructive-foreground","OVERDUE"===a.status&&"bg-accent text-accent-foreground"),children:a.status})}),(0,b.jsx)(c.TableCell,{className:"text-right py-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,b.jsx)(s,{invoice:a,clients:i,services:k,projects:m,onUpdated:A}),(0,b.jsx)(t,{invoice:a,onRecorded:A}),(0,b.jsx)(e.Button,{size:"sm",onClick:()=>B(a),disabled:!!u[String(a.invoiceNo??a._id??a.id??"")],children:u[String(a.invoiceNo??a._id??a.id??"")]?"Downloading...":"Download"}),(0,b.jsx)(e.Button,{size:"sm",variant:"destructive",onClick:async()=>{if(confirm("Delete this invoice?"))try{if(!(await fetch(`/api/invoices/${a._id??a.id}`,{method:"DELETE"})).ok)throw Error("Delete failed");await A()}catch(a){console.error(a)}},children:"Delete"}),"PAID"!==a.status&&(0,b.jsx)(e.Button,{size:"sm",className:"bg-green-600 text-white",onClick:async()=>{try{if(h(b=>b.map(b=>b._id===a._id||b.id===a.id||b.invoiceNo===a.invoiceNo?{...b,status:"PAID"}:b)),!(await fetch(`/api/invoices/${a._id??a.id??a.invoiceNo}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"PAID"})})).ok)throw Error("Failed to mark paid");await A()}catch(a){console.error("Failed to mark invoice as paid",a),await A()}},children:"Mark received"})]})})]},a._id??a.id??a.invoiceNo))})]})}),(0,b.jsx)(g.Dialog,{open:!!w,onOpenChange:a=>{a||x(null)},children:(0,b.jsxs)(g.DialogContent,{className:"max-w-4xl w-full",children:[(0,b.jsx)(g.DialogHeader,{children:(0,b.jsx)(g.DialogTitle,{children:"Invoice Preview"})}),(0,b.jsx)("div",{className:"space-y-4 max-h-[70vh] overflow-auto border-t pt-4",children:w?(0,b.jsx)("div",{className:"p-4 bg-white",children:(0,b.jsx)(o,{invoice:w,client:i.find(a=>String(a.id??a._id)===String(w.clientId))})}):(0,b.jsx)("div",{className:"p-4",children:"No preview available"})}),(0,b.jsx)(g.DialogFooter,{children:(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(e.Button,{size:"sm",onClick:()=>x(null),children:"Close"}),(0,b.jsx)(e.Button,{size:"sm",onClick:()=>w&&C(w),disabled:y,children:y?"Preparing...":"Download PDF"})]})})]})})]})}a.s(["default",()=>u],96908)}];

//# sourceMappingURL=3d860_Projects_final-pixelate_dashboard_src_app_%28crm%29_invoicing_page_tsx_5c50e0c4._.js.map